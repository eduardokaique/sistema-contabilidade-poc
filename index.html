<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Contabilidade - POC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 1000;
            overflow: visible;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .header-nav {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
            white-space: nowrap;
        }

        .nav {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            overflow: visible;
            max-width: 100%;
        }

        .nav-dropdown {
            position: relative;
            z-index: 9999;
        }

        .nav-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
            min-width: max-content;
            flex-shrink: 0;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #2c3e50, #34495e);
        }

        .nav-btn.dropdown-toggle::after {
            content: '‚ñº';
            font-size: 0.7rem;
            transition: transform 0.3s ease;
        }

        .nav-dropdown:hover .nav-btn.dropdown-toggle::after {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: fixed;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
            min-width: 220px;
            max-width: 300px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 99999;
            border: 1px solid rgba(255, 255, 255, 0.2);
            max-height: 400px;
            overflow-y: auto;
            left: 0;
            top: 0;
        }

        .nav-dropdown:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        /* Posicionamento ser√° feito via JavaScript */

        /* Ajustes espec√≠ficos para desktop largo */
        @media (min-width: 1400px) {
            .nav {
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .nav-btn {
                padding: 10px 16px;
                font-size: 0.85rem;
                gap: 6px;
            }
        }

        /* Desktop m√©dio */
        @media (min-width: 1200px) and (max-width: 1399px) {
            .nav {
                gap: 8px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .nav-btn {
                padding: 9px 14px;
                font-size: 0.8rem;
                gap: 5px;
            }
        }

        /* Desktop pequeno e tablets */
        @media (min-width: 769px) and (max-width: 1199px) {
            .nav {
                gap: 6px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .nav-btn {
                padding: 8px 12px;
                font-size: 0.75rem;
                gap: 4px;
            }
            
            .module-icon {
                font-size: 0.85rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header {
                padding: 12px 15px;
            }
        }

        .dropdown-item {
            display: block;
            padding: 12px 20px;
            color: #2c3e50;
            text-decoration: none;
            transition: all 0.3s ease;
            border-radius: 10px;
            margin: 5px;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
            background: none;
            width: calc(100% - 10px);
            text-align: left;
        }

        .dropdown-item:hover {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            transform: translateX(5px);
        }

        .dropdown-item.active {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
        }

        .module-icon {
            font-size: 1rem;
            margin-right: 8px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .esocial-tab {
            display: none;
        }

        .esocial-tab.active {
            display: block;
        }

        .evento-form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #e9ecef;
        }

        .evento-form h4 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .main-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 600px;
            position: relative;
            z-index: 0;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .card .value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e0e6ed;
        }

        th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .status {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status.receita {
            background: #d4edda;
            color: #155724;
        }

        .status.despesa {
            background: #f8d7da;
            color: #721c24;
        }

        .status.pago {
            background: #d4edda;
            color: #155724;
        }

        /* Status espec√≠ficos para usu√°rios */
        .status.admin {
            background: linear-gradient(45deg, #9b59b6, #8e44ad);
            color: white;
        }

        .status.usuario {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }

        .status.contador {
            background: linear-gradient(45deg, #e67e22, #d35400);
            color: white;
        }

        .status.ativo {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .status.bloqueado {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        /* Status e-Social */
        .status.success {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
        }

        .status.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .status.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        /* Estilos do Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e0e6ed;
        }

        .modal-header h3 {
            margin: 0;
            color: #2c3e50;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 20px;
            border-top: 1px solid #e0e6ed;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            overflow: hidden;
        }

        .chart-container canvas {
            width: 100% !important;
            height: auto !important;
            max-width: 100%;
            min-height: 250px;
        }

        @media (max-width: 768px) {
            .chart-container {
                padding: 15px;
                margin-top: 15px;
            }
            
            .chart-container h3 {
                font-size: 1.2rem;
                margin-bottom: 15px;
                text-align: center;
            }
            
            #chartTooltip {
                font-size: 11px !important;
                padding: 6px !important;
                max-width: 200px;
                word-wrap: break-word;
            }
            
            .chart-container canvas {
                min-height: 200px;
            }
        }

        /* Menu Hamb√∫rguer para Mobile */
        .hamburger-menu {
            display: none;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            z-index: 10000;
        }

        /* Estilos do bot√£o de login */
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .login-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .login-btn:hover {
            background: linear-gradient(45deg, #218838, #17a2b8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Estilos do modal de login */
        .login-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
        }

        .login-modal-content {
            position: relative;
            background: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .login-header h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .login-close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .login-close:hover {
            opacity: 1;
        }

        #loginForm {
            padding: 25px;
        }

        .login-form-group {
            margin-bottom: 20px;
        }

        .login-form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 0.95rem;
        }

        .login-form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .login-form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-demo-info {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .login-demo-info h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 1rem;
        }

        .login-demo-info p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #555;
        }

        .login-submit-btn {
            width: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .login-submit-btn:hover {
            background: linear-gradient(45deg, #5a6fd8, #6a42a0);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .login-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
            display: none;
        }

        .login-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .login-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Tela de login inicial em tela cheia */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10002;
            padding: 20px;
            box-sizing: border-box;
        }

        .login-screen-content {
            background: white;
            padding: 0;
            border-radius: 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            animation: loginScreenSlideIn 0.6s ease-out;
        }

        @keyframes loginScreenSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .login-screen-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
        }

        .login-screen-header h1 {
            margin: 0 0 10px 0;
            font-size: 2rem;
            font-weight: 700;
        }

        .login-screen-header p {
            margin: 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .login-screen-form {
            padding: 40px 30px;
        }

        .login-screen-form .login-form-group {
            margin-bottom: 25px;
        }

        .login-screen-form .login-form-group input {
            padding: 15px 20px;
            font-size: 1.1rem;
            border: 2px solid #e8ecef;
            border-radius: 10px;
        }

        .login-screen-form .login-submit-btn {
            padding: 16px;
            font-size: 1.2rem;
            border-radius: 10px;
            margin-top: 20px;
        }

        .sistema-oculto {
            display: none !important;
        }

        /* Responsividade para tela de login */
        @media (max-width: 768px) {
            .login-screen-content {
                margin: 0 auto;
                max-width: 95%;
            }

            .login-screen-header h1 {
                font-size: 1.5rem;
            }

            .login-screen-header p {
                font-size: 1rem;
            }

            .login-screen-form {
                padding: 30px 20px;
            }

            .login-demo-info {
                margin: 15px 0;
                padding: 12px;
            }
        }

        .mobile-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-menu-overlay.active {
            opacity: 1;
        }

        .mobile-menu {
            position: fixed;
            top: 0;
            left: -320px;
            width: 320px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            transition: left 0.3s ease;
            z-index: 9999;
            overflow-y: auto;
            padding: 20px 0;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
        }

        .mobile-menu.active {
            left: 0;
        }

        .mobile-menu-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mobile-menu-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .mobile-menu-section {
            padding: 10px 0;
        }

        .mobile-menu-title {
            padding: 15px 20px 10px;
            font-weight: bold;
            color: white;
            font-size: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            background: linear-gradient(45deg, #667eea, #764ba2);
            margin: 0;
        }

        .mobile-menu-item {
            display: block;
            padding: 15px 20px 15px 40px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .mobile-menu-item:hover,
        .mobile-menu-item:focus {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding-left: 50px;
        }

        .mobile-menu-item .module-icon {
            margin-right: 10px;
            font-size: 1rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header-nav {
                display: none;
            }

            .hamburger-menu {
                display: block;
            }

            .mobile-menu-overlay {
                display: block;
            }
            
            .header-top {
                margin-bottom: 0;
            }

            .dashboard-cards {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 15px;
            }

            .main-content {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .mobile-menu {
                width: 280px;
                left: -280px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .main-content {
                padding: 15px;
            }

            .dashboard-cards {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Tela de login inicial -->
    <div id="loginScreen" class="login-screen">
        <div class="login-screen-content">
            <div class="login-screen-header">
                <h1>üîê Sistema de Contabilidade</h1>
                <p>Fa√ßa login para acessar o sistema</p>
            </div>
            <form id="loginScreenForm" class="login-screen-form" onsubmit="realizarLoginInicial(event)">
                <div class="login-form-group">
                    <label for="screenUsername">üë§ Usu√°rio:</label>
                    <input type="text" id="screenUsername" required placeholder="Digite seu usu√°rio" autofocus>
                </div>
                <div class="login-form-group">
                    <label for="screenPassword">üîí Senha:</label>
                    <input type="password" id="screenPassword" required placeholder="Digite sua senha">
                </div>
                <div class="login-demo-info">
                    <h4>üìã Dados de Demonstra√ß√£o:</h4>
                    <p><strong>Usu√°rio:</strong> admin | <strong>Senha:</strong> demo123</p>
                    <p><strong>Usu√°rio:</strong> contador | <strong>Senha:</strong> contabil2024</p>
                </div>
                <button type="submit" class="login-submit-btn">üöÄ Entrar no Sistema</button>
                <div id="loginScreenMessage" class="login-message"></div>
            </form>
        </div>
    </div>

    <div id="sistemaContainer" class="container sistema-oculto">
        <header class="header">
            <div class="header-top">
                <h1>üìä Sistema de Contabilidade</h1>
                <div class="header-actions">
                    <button class="login-btn" onclick="toggleLoginModal()">
                        üë§ Login
                    </button>
                    <button class="hamburger-menu" onclick="toggleMobileMenu()" onmousedown="console.log('Hamburger clicked')">
                        ‚ò∞
                    </button>
                </div>
            </div>
            <div class="header-nav">
                <nav class="nav">
                <!-- Dashboard Principal -->
                <button class="nav-btn active" onclick="showSection('dashboard')">
                    <span class="module-icon">üìä</span> Dashboard
                </button>


                <!-- M√≥dulo Cont√°bil -->
                <div class="nav-dropdown">
                    <button class="nav-btn dropdown-toggle">
                        <span class="module-icon">üìö</span> Cont√°bil
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" onclick="showSection('lancamentos')">
                            <span class="module-icon">üí∞</span> Lan√ßamentos
                        </button>
                        <button class="dropdown-item" onclick="showSection('contas')">
                            <span class="module-icon">üè¶</span> Plano de Contas
                        </button>
                        <button class="dropdown-item" onclick="showSection('diario')">
                            <span class="module-icon">üìñ</span> Livro Di√°rio
                        </button>
                        <button class="dropdown-item" onclick="showSection('razao')">
                            <span class="module-icon">üìã</span> Livro Raz√£o
                        </button>
                        <button class="dropdown-item" onclick="showSection('contasreceber')">
                            <span class="module-icon">üí∏</span> Contas a Pagar/Receber
                        </button>
                    </div>
                </div>

                <!-- M√≥dulo Relat√≥rios -->
                <div class="nav-dropdown">
                    <button class="nav-btn dropdown-toggle">
                        <span class="module-icon">üìä</span> Relat√≥rios
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" onclick="showSection('relatorios')">
                            <span class="module-icon">üìà</span> DRE
                        </button>
                        <button class="dropdown-item" onclick="showSection('balanco')">
                            <span class="module-icon">‚öñÔ∏è</span> Balan√ßo Patrimonial
                        </button>
                    </div>
                </div>

                <!-- M√≥dulo Fiscal -->
                <div class="nav-dropdown">
                    <button class="nav-btn dropdown-toggle">
                        <span class="module-icon">üèõÔ∏è</span> Fiscal
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" onclick="showSection('fiscal')">
                            <span class="module-icon">üìÑ</span> Apura√ß√£o de Impostos
                        </button>
                        <button class="dropdown-item" onclick="showSection('sped')">
                            <span class="module-icon">üìä</span> SPED Fiscal
                        </button>
                    </div>
                </div>

                <!-- M√≥dulo Folha -->
                <div class="nav-dropdown">
                    <button class="nav-btn dropdown-toggle">
                        <span class="module-icon">üë•</span> RH & Folha
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" onclick="showSection('folha')">
                            <span class="module-icon">üí∞</span> Folha de Pagamento
                        </button>
                        <button class="dropdown-item" onclick="showFuncionariosSection()">
                            <span class="module-icon">üë§</span> Funcion√°rios
                        </button>
                        <button class="dropdown-item" onclick="showSection('esocial')">
                            <span class="module-icon">üîó</span> e-Social
                        </button>
                    </div>
                </div>

                <!-- Configura√ß√µes -->
                <div class="nav-dropdown">
                    <button class="nav-btn dropdown-toggle">
                        <span class="module-icon">‚öôÔ∏è</span> Configura√ß√µes
                    </button>
                    <div class="dropdown-menu">
                        <button class="dropdown-item" onclick="showSection('config-empresa')">
                            <span class="module-icon">üè¢</span> Dados da Empresa
                        </button>
                        <button class="dropdown-item" onclick="showSection('config-sistema')">
                            <span class="module-icon">üîß</span> Sistema
                        </button>
                        <button class="dropdown-item" onclick="showSection('config-usuarios')">
                            <span class="module-icon">üë•</span> Usu√°rios
                        </button>
                        <button class="dropdown-item" onclick="showSection('config-backup')">
                            <span class="module-icon">üíæ</span> Backup & Dados
                        </button>
                        <button class="dropdown-item" onclick="showSection('config-contas')">
                            <span class="module-icon">üè¶</span> Plano de Contas
                        </button>
                    </div>
                </div>
                </nav>
            </div>
        </header>

        <!-- Menu Mobile -->
        <div class="mobile-menu-overlay" onclick="closeMobileMenu()" id="mobileMenuOverlay"></div>
        <div class="mobile-menu" id="mobileMenu">
            <div class="mobile-menu-header">
                <h3>üìä Menu</h3>
                <button class="mobile-menu-close" onclick="closeMobileMenu()">‚úï</button>
            </div>
            
            <div class="mobile-menu-section">
                <button class="mobile-menu-item" onclick="showSection('dashboard'); closeMobileMenu();">
                    <span class="module-icon">üìä</span> Dashboard
                </button>
            </div>

            <div class="mobile-menu-section">
                <h4 class="mobile-menu-title">
                    <span class="module-icon">üìö</span> Cont√°bil
                </h4>
                <button class="mobile-menu-item" onclick="showSection('lancamentos'); closeMobileMenu();">
                    <span class="module-icon">üí∞</span> Lan√ßamentos
                </button>
                <button class="mobile-menu-item" onclick="showSection('contas'); closeMobileMenu();">
                    <span class="module-icon">üè¶</span> Plano de Contas
                </button>
                <button class="mobile-menu-item" onclick="showSection('diario'); closeMobileMenu();">
                    <span class="module-icon">üìñ</span> Livro Di√°rio
                </button>
                <button class="mobile-menu-item" onclick="showSection('razao'); closeMobileMenu();">
                    <span class="module-icon">üìã</span> Livro Raz√£o
                </button>
                <button class="mobile-menu-item" onclick="showSection('contasreceber'); closeMobileMenu();">
                    <span class="module-icon">üí∏</span> Contas a Pagar/Receber
                </button>
            </div>

            <div class="mobile-menu-section">
                <h4 class="mobile-menu-title">
                    <span class="module-icon">üìä</span> Relat√≥rios
                </h4>
                <button class="mobile-menu-item" onclick="showSection('relatorios'); closeMobileMenu();">
                    <span class="module-icon">üìà</span> DRE
                </button>
                <button class="mobile-menu-item" onclick="showSection('balanco'); closeMobileMenu();">
                    <span class="module-icon">‚öñÔ∏è</span> Balan√ßo Patrimonial
                </button>
            </div>

            <div class="mobile-menu-section">
                <h4 class="mobile-menu-title">
                    <span class="module-icon">üèõÔ∏è</span> Fiscal
                </h4>
                <button class="mobile-menu-item" onclick="showSection('fiscal'); closeMobileMenu();">
                    <span class="module-icon">üìã</span> Obriga√ß√µes Fiscais
                </button>
                <button class="mobile-menu-item" onclick="showSection('sped'); closeMobileMenu();">
                    <span class="module-icon">üìÑ</span> SPED Cont√°bil
                </button>
            </div>

            <div class="mobile-menu-section">
                <h4 class="mobile-menu-title">
                    <span class="module-icon">üë•</span> RH & Folha
                </h4>
                <button class="mobile-menu-item" onclick="showSection('folha'); closeMobileMenu();">
                    <span class="module-icon">üíº</span> Folha de Pagamento
                </button>
                <button class="mobile-menu-item" onclick="showFuncionariosSection(); closeMobileMenu();">
                    <span class="module-icon">üë§</span> Funcion√°rios
                </button>
                <button class="mobile-menu-item" onclick="showSection('esocial'); closeMobileMenu();">
                    <span class="module-icon">üîó</span> e-Social
                </button>
            </div>

            <div class="mobile-menu-section">
                <h4 class="mobile-menu-title">
                    <span class="module-icon">‚öôÔ∏è</span> Configura√ß√µes
                </h4>
                <button class="mobile-menu-item" onclick="showSection('config-empresa'); closeMobileMenu();">
                    <span class="module-icon">üè¢</span> Dados da Empresa
                </button>
                <button class="mobile-menu-item" onclick="showSection('config-sistema'); closeMobileMenu();">
                    <span class="module-icon">üîß</span> Sistema
                </button>
                <button class="mobile-menu-item" onclick="showSection('config-usuarios'); closeMobileMenu();">
                    <span class="module-icon">üë•</span> Usu√°rios
                </button>
                <button class="mobile-menu-item" onclick="showSection('config-backup'); closeMobileMenu();">
                    <span class="module-icon">üíæ</span> Backup & Dados
                </button>
                <button class="mobile-menu-item" onclick="showSection('config-contas'); closeMobileMenu();">
                    <span class="module-icon">üè¶</span> Plano de Contas
                </button>
            </div>
        </div>

        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <h2>Dashboard Financeiro</h2>
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>üí∞ Receitas do M√™s</h3>
                        <div class="value" id="receitas-mes">R$ 45.680,00</div>
                        <small>+12% vs m√™s anterior</small>
                    </div>
                    <div class="card">
                        <h3>üí∏ Despesas do M√™s</h3>
                        <div class="value" id="despesas-mes">R$ 32.450,00</div>
                        <small>-5% vs m√™s anterior</small>
                    </div>
                    <div class="card">
                        <h3>üìà Lucro L√≠quido</h3>
                        <div class="value" id="lucro-liquido">R$ 13.230,00</div>
                        <small>+18% vs m√™s anterior</small>
                    </div>
                    <div class="card">
                        <h3>üè¶ Saldo em Caixa</h3>
                        <div class="value" id="saldo-caixa">R$ 87.920,00</div>
                        <small>Atualizado em tempo real</small>
                    </div>
                </div>

                <div class="chart-container">
                    <h3>Fluxo de Caixa - √öltimos 6 Meses</h3>
                    <div style="position: relative;">
                        <canvas id="fluxoCaixaChart" width="400" height="200" style="cursor: pointer;"></canvas>
                        <div id="chartTooltip" style="position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 8px; border-radius: 4px; font-size: 12px; pointer-events: none; display: none; z-index: 1000;"></div>
                    </div>
                </div>
            </section>

            <!-- Lan√ßamentos Section -->
            <section id="lancamentos" class="section">
                <h2>Lan√ßamentos Cont√°beis</h2>
                
                <form id="lancamento-form" style="margin-bottom: 30px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data">Data:</label>
                            <input type="date" id="data" required>
                        </div>
                        <div class="form-group">
                            <label for="tipo">Tipo:</label>
                            <select id="tipo" required>
                                <option value="">Selecione...</option>
                                <option value="receita">Receita</option>
                                <option value="despesa">Despesa</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conta">Conta:</label>
                            <select id="conta" required>
                                <option value="">Selecione...</option>
                                <option value="caixa">Caixa</option>
                                <option value="banco">Banco</option>
                                <option value="vendas">Vendas</option>
                                <option value="fornecedores">Fornecedores</option>
                                <option value="despesas-operacionais">Despesas Operacionais</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="valor">Valor (R$):</label>
                            <input type="number" id="valor" step="0.01" min="0" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="descricao">Descri√ß√£o:</label>
                        <textarea id="descricao" rows="3" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn">Adicionar Lan√ßamento</button>
                </form>

                <div class="table-container">
                    <table id="lancamentos-table">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Tipo</th>
                                <th>Conta</th>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="lancamentos-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Relat√≥rios Section -->
            <section id="relatorios" class="section">
                <h2>Relat√≥rios Financeiros</h2>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="periodo-inicio">Per√≠odo - In√≠cio:</label>
                        <input type="date" id="periodo-inicio">
                    </div>
                    <div class="form-group">
                        <label for="periodo-fim">Per√≠odo - Fim:</label>
                        <input type="date" id="periodo-fim">
                    </div>
                </div>
                
                <button class="btn" onclick="gerarRelatorio()">Gerar Relat√≥rio</button>
                
                <div id="relatorio-resultado" class="chart-container" style="display: none;">
                    <h3>Demonstrativo do Resultado do Exerc√≠cio (DRE)</h3>
                    <div id="dre-content"></div>
                </div>
            </section>

            <!-- Contas Section -->
            <section id="contas" class="section">
                <h2>Plano de Contas</h2>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nome da Conta</th>
                                <th>Tipo</th>
                                <th>Saldo Atual</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="contas-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Livro Di√°rio Section -->
            <section id="diario" class="section">
                <h2>üìñ Livro Di√°rio</h2>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="diario-inicio">Per√≠odo - In√≠cio:</label>
                        <input type="date" id="diario-inicio">
                    </div>
                    <div class="form-group">
                        <label for="diario-fim">Per√≠odo - Fim:</label>
                        <input type="date" id="diario-fim">
                    </div>
                </div>
                
                <button class="btn" onclick="filtrarDiario()">Filtrar Per√≠odo</button>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Hist√≥rico</th>
                                <th>Conta</th>
                                <th>D√©bito</th>
                                <th>Cr√©dito</th>
                            </tr>
                        </thead>
                        <tbody id="diario-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Livro Raz√£o Section -->
            <section id="razao" class="section">
                <h2>üìö Livro Raz√£o</h2>
                
                <div class="form-group" style="max-width: 300px; margin-bottom: 20px;">
                    <label for="conta-filtro">Filtrar por Conta:</label>
                    <select id="conta-filtro">
                        <option value="">Todas as contas</option>
                        <option value="caixa">Caixa</option>
                        <option value="banco">Banco</option>
                        <option value="vendas">Vendas</option>
                        <option value="fornecedores">Fornecedores</option>
                        <option value="despesas-operacionais">Despesas Operacionais</option>
                    </select>
                </div>
                
                <button class="btn" onclick="filtrarRazao()">Atualizar Raz√£o</button>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Hist√≥rico</th>
                                <th>D√©bito</th>
                                <th>Cr√©dito</th>
                                <th>Saldo</th>
                            </tr>
                        </thead>
                        <tbody id="razao-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Balan√ßo Patrimonial Section -->
            <section id="balanco" class="section">
                <h2>‚öñÔ∏è Balan√ßo Patrimonial</h2>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="balanco-data">Data de Refer√™ncia:</label>
                        <input type="date" id="balanco-data">
                    </div>
                </div>
                
                <button class="btn" onclick="gerarBalanco()">Gerar Balan√ßo</button>
                
                <div id="balanco-resultado" class="chart-container" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h3>ATIVO</h3>
                            <div id="ativo-content"></div>
                        </div>
                        <div>
                            <h3>PASSIVO + PATRIM√îNIO L√çQUIDO</h3>
                            <div id="passivo-content"></div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <div id="totais-balanco"></div>
                    </div>
                </div>
            </section>

            <!-- Contas a Receber Section -->
            <section id="contasreceber" class="section">
                <h2>üí∞ Contas a Pagar/Receber</h2>
                
                <form id="conta-form" style="margin-bottom: 30px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conta-tipo">Tipo:</label>
                            <select id="conta-tipo" required>
                                <option value="">Selecione...</option>
                                <option value="receber">Conta a Receber</option>
                                <option value="pagar">Conta a Pagar</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="conta-vencimento">Data de Vencimento:</label>
                            <input type="date" id="conta-vencimento" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="conta-cliente">Cliente/Fornecedor:</label>
                            <input type="text" id="conta-cliente" required>
                        </div>
                        <div class="form-group">
                            <label for="conta-valor">Valor (R$):</label>
                            <input type="number" id="conta-valor" step="0.01" min="0" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="conta-descricao">Descri√ß√£o:</label>
                        <textarea id="conta-descricao" rows="2" required></textarea>
                    </div>
                    
                    <button type="submit" class="btn">Adicionar Conta</button>
                </form>

                <div class="dashboard-cards" style="margin-bottom: 20px;">
                    <div class="card">
                        <h3>üí∞ Total a Receber</h3>
                        <div class="value" id="total-receber">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <h3>üí∏ Total a Pagar</h3>
                        <div class="value" id="total-pagar">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <h3>‚ö†Ô∏è Vencidas</h3>
                        <div class="value" id="total-vencidas">0</div>
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Tipo</th>
                                <th>Vencimento</th>
                                <th>Cliente/Fornecedor</th>
                                <th>Descri√ß√£o</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="contas-receber-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- M√≥dulo Fiscal Section -->
            <section id="fiscal" class="section">
                <h2>üèõÔ∏è M√≥dulo Fiscal</h2>
                
                <div class="dashboard-cards" style="margin-bottom: 20px;">
                    <div class="card">
                        <h3>üìÑ ICMS a Recolher</h3>
                        <div class="value" id="icms-recolher">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <h3>üìÑ PIS/COFINS</h3>
                        <div class="value" id="pis-cofins">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <h3>üìä SPED Fiscal</h3>
                        <div class="value" id="sped-status">Pendente</div>
                    </div>
                </div>

                <!-- Apura√ß√£o de Impostos -->
                <h3>Apura√ß√£o de Impostos</h3>
                <form id="imposto-form" style="margin-bottom: 30px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="imposto-tipo">Tipo de Imposto:</label>
                            <select id="imposto-tipo" required>
                                <option value="">Selecione...</option>
                                <option value="icms">ICMS</option>
                                <option value="ipi">IPI</option>
                                <option value="pis">PIS</option>
                                <option value="cofins">COFINS</option>
                                <option value="irpj">IRPJ</option>
                                <option value="csll">CSLL</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="imposto-periodo">Per√≠odo:</label>
                            <input type="month" id="imposto-periodo" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="imposto-base">Base de C√°lculo (R$):</label>
                            <input type="number" id="imposto-base" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="imposto-aliquota">Al√≠quota (%):</label>
                            <input type="number" id="imposto-aliquota" step="0.01" min="0" max="100" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn">Apurar Imposto</button>
                </form>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Imposto</th>
                                <th>Per√≠odo</th>
                                <th>Base de C√°lculo</th>
                                <th>Al√≠quota</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="impostos-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>

            </section>

            <!-- SPED Fiscal Section -->
            <section id="sped" class="section">
                <h2>üìä SPED Fiscal</h2>
                
                <div class="dashboard-cards" style="margin-bottom: 20px;">
                    <div class="card">
                        <h3>üìÑ Status SPED</h3>
                        <div class="value" id="sped-status-card">Pendente</div>
                    </div>
                    <div class="card">
                        <h3>üìÖ √öltimo Per√≠odo</h3>
                        <div class="value" id="ultimo-periodo">2024-08</div>
                    </div>
                    <div class="card">
                        <h3>üìä Registros Gerados</h3>
                        <div class="value" id="total-registros">0</div>
                    </div>
                </div>

                <!-- Gera√ß√£o do SPED -->
                <h3>Gera√ß√£o do SPED Fiscal</h3>
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="sped-periodo">Per√≠odo de Apura√ß√£o:</label>
                        <input type="month" id="sped-periodo">
                    </div>
                    <div class="form-group">
                        <label for="sped-cnpj">CNPJ da Empresa:</label>
                        <input type="text" id="sped-cnpj" value="12.345.678/0001-99" readonly>
                    </div>
                </div>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="sped-razao">Raz√£o Social:</label>
                        <input type="text" id="sped-razao" value="EMPRESA EXEMPLO LTDA" readonly>
                    </div>
                    <div class="form-group">
                        <label for="sped-ie">Inscri√ß√£o Estadual:</label>
                        <input type="text" id="sped-ie" value="123456789" readonly>
                    </div>
                </div>
                
                <button class="btn" onclick="gerarSpedFiscal()">üîÑ Gerar SPED Fiscal</button>
                <button class="btn" onclick="validarSpedFiscal()" style="margin-left: 10px;">‚úÖ Validar SPED</button>
                <button class="btn" onclick="exportarSpedFiscal()" style="margin-left: 10px;">üíæ Exportar Arquivo</button>
                
                <div id="sped-resultado" class="chart-container" style="display: none; margin-top: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h4>üìÑ Arquivo SPED Fiscal Gerado</h4>
                        <span id="sped-data-geracao" style="color: #666; font-size: 0.9rem;"></span>
                    </div>
                    
                    <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div>
                                <strong>Per√≠odo:</strong>
                                <span id="sped-periodo-exibido"></span>
                            </div>
                            <div>
                                <strong>Total de Registros:</strong>
                                <span id="sped-total-registros"></span>
                            </div>
                            <div>
                                <strong>Status:</strong>
                                <span id="sped-status-validacao" class="status pago">V√°lido</span>
                            </div>
                        </div>
                    </div>
                    
                    <div id="sped-content" style="max-height: 400px; overflow-y: auto;"></div>
                </div>

                <!-- Hist√≥rico de SPED -->
                <div style="margin-top: 40px;">
                    <h3>üìã Hist√≥rico de SPED Gerados</h3>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Per√≠odo</th>
                                    <th>Data de Gera√ß√£o</th>
                                    <th>Registros</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="historico-sped-tbody">
                                <!-- Dados ser√£o inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Folha de Pagamento Section -->
            <section id="folha" class="section">
                <h2>üë• Folha de Pagamento</h2>
                
                <div class="dashboard-cards" style="margin-bottom: 20px;">
                    <div class="card">
                        <h3>üë• Total Funcion√°rios</h3>
                        <div class="value" id="total-funcionarios">0</div>
                    </div>
                    <div class="card">
                        <h3>üí∞ Folha Bruta</h3>
                        <div class="value" id="folha-bruta">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <h3>üìä Encargos</h3>
                        <div class="value" id="total-encargos">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <h3>üí∏ Folha L√≠quida</h3>
                        <div class="value" id="folha-liquida">R$ 0,00</div>
                    </div>
                </div>

                <!-- Cadastro de Funcion√°rio -->
                <h3>Cadastro de Funcion√°rios</h3>
                <form id="funcionario-form" style="margin-bottom: 30px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="func-nome">Nome Completo:</label>
                            <input type="text" id="func-nome" required>
                        </div>
                        <div class="form-group">
                            <label for="func-cpf">CPF:</label>
                            <input type="text" id="func-cpf" placeholder="000.000.000-00" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="func-cargo">Cargo:</label>
                            <input type="text" id="func-cargo" required>
                        </div>
                        <div class="form-group">
                            <label for="func-departamento">Departamento:</label>
                            <select id="func-departamento" required>
                                <option value="">Selecione...</option>
                                <option value="administrativo">Administrativo</option>
                                <option value="vendas">Vendas</option>
                                <option value="producao">Produ√ß√£o</option>
                                <option value="financeiro">Financeiro</option>
                                <option value="rh">Recursos Humanos</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="func-salario">Sal√°rio Bruto (R$):</label>
                            <input type="number" id="func-salario" step="0.01" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="func-admissao">Data de Admiss√£o:</label>
                            <input type="date" id="func-admissao" required>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn">Cadastrar Funcion√°rio</button>
                </form>

                <!-- Lista de Funcion√°rios -->
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>Cargo</th>
                                <th>Departamento</th>
                                <th>Sal√°rio Bruto</th>
                                <th>Sal. L√≠quido</th>
                                <th>Admiss√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="funcionarios-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Processamento da Folha -->
                <div style="margin-top: 30px;">
                    <h3>Processamento da Folha</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="folha-periodo">Per√≠odo:</label>
                            <input type="month" id="folha-periodo">
                        </div>
                    </div>
                    <button class="btn" onclick="processarFolha()">Processar Folha de Pagamento</button>
                    
                    <div id="folha-resultado" class="chart-container" style="display: none; margin-top: 20px;">
                        <h4>Resumo da Folha Processada</h4>
                        <div id="folha-resumo"></div>
                    </div>
                </div>
            </section>

            <!-- e-Social Section -->
            <section id="esocial" class="section">
                <h2>üîó e-Social</h2>
                
                <div class="dashboard-cards" style="margin-bottom: 20px;">
                    <div class="card">
                        <h3>üì§ Eventos Enviados</h3>
                        <div class="value" id="esocial-enviados">0</div>
                    </div>
                    <div class="card">
                        <h3>‚è≥ Pendentes</h3>
                        <div class="value" id="esocial-pendentes">0</div>
                    </div>
                    <div class="card">
                        <h3>‚ùå Com Erro</h3>
                        <div class="value" id="esocial-erros">0</div>
                    </div>
                    <div class="card">
                        <h3>‚úÖ Processados</h3>
                        <div class="value" id="esocial-processados">0</div>
                    </div>
                </div>

                <!-- Tabs de Eventos -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #e0e6ed;">
                    <button class="tab-btn active" onclick="showEsocialTab('eventos')">üìã Gest√£o de Eventos</button>
                    <button class="tab-btn" onclick="showEsocialTab('trabalhadores')">üë§ Trabalhadores</button>
                    <button class="tab-btn" onclick="showEsocialTab('remuneracao')">üí∞ Remunera√ß√£o</button>
                    <button class="tab-btn" onclick="showEsocialTab('transmissao')">üì° Transmiss√£o</button>
                </div>

                <!-- Tab: Gest√£o de Eventos -->
                <div id="esocial-eventos" class="esocial-tab active">
                    <h3>üìã Eventos e-Social</h3>
                    
                    <div class="form-row" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label for="evento-tipo">Tipo de Evento:</label>
                            <select id="evento-tipo" onchange="mostrarFormularioEvento()">
                                <option value="">Selecione o evento...</option>
                                <option value="S-1200">S-1200 - Remunera√ß√£o de Trabalhador</option>
                                <option value="S-2200">S-2200 - Admiss√£o de Trabalhador</option>
                                <option value="S-2299">S-2299 - Desligamento</option>
                                <option value="S-2230">S-2230 - Afastamento Tempor√°rio</option>
                                <option value="S-1299">S-1299 - Fechamento Mensal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evento-periodo">Per√≠odo de Compet√™ncia:</label>
                            <input type="month" id="evento-periodo">
                        </div>
                    </div>

                    <!-- Formul√°rio S-1200 -->
                    <div id="form-s1200" class="evento-form" style="display: none;">
                        <h4>S-1200 - Remunera√ß√£o de Trabalhador</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="s1200-funcionario">Funcion√°rio:</label>
                                <select id="s1200-funcionario" onchange="preencherDadosFuncionario()">
                                    <option value="">Selecione o funcion√°rio...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="s1200-categoria">Categoria:</label>
                                <select id="s1200-categoria">
                                    <option value="101">101 - Empregado geral</option>
                                    <option value="102">102 - Empregado rural</option>
                                    <option value="103">103 - Empregado dom√©stico</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="gerarEventoS1200()">Gerar S-1200</button>
                    </div>

                    <!-- Formul√°rio S-2200 -->
                    <div id="form-s2200" class="evento-form" style="display: none;">
                        <h4>S-2200 - Admiss√£o de Trabalhador</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="s2200-funcionario">Funcion√°rio:</label>
                                <select id="s2200-funcionario">
                                    <option value="">Selecione o funcion√°rio...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="s2200-matricula">Matr√≠cula:</label>
                                <input type="text" id="s2200-matricula">
                            </div>
                        </div>
                        <button class="btn" onclick="gerarEventoS2200()">Gerar S-2200</button>
                    </div>

                    <!-- Formul√°rio S-2299 -->
                    <div id="form-s2299" class="evento-form" style="display: none;">
                        <h4>S-2299 - Desligamento</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="s2299-funcionario">Funcion√°rio:</label>
                                <select id="s2299-funcionario">
                                    <option value="">Selecione o funcion√°rio...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="s2299-data">Data de Desligamento:</label>
                                <input type="date" id="s2299-data">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="s2299-motivo">Motivo:</label>
                            <select id="s2299-motivo">
                                <option value="01">01 - Dispensa sem justa causa</option>
                                <option value="02">02 - Dispensa por justa causa</option>
                                <option value="03">03 - T√©rmino de contrato</option>
                                <option value="04">04 - Rescis√£o antecipada pelo empregado</option>
                            </select>
                        </div>
                        <button class="btn" onclick="gerarEventoS2299()">Gerar S-2299</button>
                    </div>

                    <!-- Lista de Eventos -->
                    <div class="table-container" style="margin-top: 30px;">
                        <h4>üìã Eventos Gerados</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>Evento</th>
                                    <th>Funcion√°rio</th>
                                    <th>Per√≠odo</th>
                                    <th>Status</th>
                                    <th>Data Cria√ß√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="eventos-esocial-tbody">
                                <!-- Dados ser√£o inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab: Trabalhadores -->
                <div id="esocial-trabalhadores" class="esocial-tab">
                    <h3>üë§ Cadastro de Trabalhadores e-Social</h3>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>CPF</th>
                                    <th>Cargo</th>
                                    <th>Admiss√£o</th>
                                    <th>Status e-Social</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="trabalhadores-esocial-tbody">
                                <!-- Dados ser√£o inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab: Remunera√ß√£o -->
                <div id="esocial-remuneracao" class="esocial-tab">
                    <h3>üí∞ Controle de Remunera√ß√£o</h3>
                    
                    <div class="form-row" style="margin-bottom: 20px;">
                        <div class="form-group">
                            <label for="rem-periodo">Per√≠odo:</label>
                            <input type="month" id="rem-periodo">
                        </div>
                    </div>
                    <button class="btn" onclick="processarRemuneracaoMensal()">üîÑ Processar Remunera√ß√£o Mensal</button>
                    
                    <div class="table-container" style="margin-top: 20px;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Funcion√°rio</th>
                                    <th>Per√≠odo</th>
                                    <th>Sal√°rio Base</th>
                                    <th>Proventos</th>
                                    <th>Descontos</th>
                                    <th>Status S-1200</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="remuneracao-esocial-tbody">
                                <!-- Dados ser√£o inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab: Transmiss√£o -->
                <div id="esocial-transmissao" class="esocial-tab">
                    <h3>üì° Transmiss√£o e Monitoramento</h3>
                    
                    <div class="dashboard-cards" style="margin-bottom: 20px;">
                        <div class="card">
                            <h3>üîÑ Fila de Transmiss√£o</h3>
                            <div class="value" id="fila-transmissao">0</div>
                        </div>
                        <div class="card">
                            <h3>‚úÖ Processados Hoje</h3>
                            <div class="value" id="processados-hoje">0</div>
                        </div>
                    </div>

                    <button class="btn" onclick="transmitirEventos()">üì§ Transmitir Eventos Pendentes</button>
                    <button class="btn" onclick="consultarRetornos()" style="margin-left: 10px;">üîç Consultar Retornos</button>
                    <button class="btn" onclick="validarTodosFuncionarios()" style="margin-left: 10px;">‚úÖ Validar Dados</button>
                    <button class="btn" onclick="processarIntegracaoContabil()" style="margin-left: 10px;">üîó Integra√ß√£o Cont√°bil</button>
                    
                    <div id="transmissao-resultado" class="chart-container" style="display: none; margin-top: 20px;">
                        <h4>üìä Resultado da Transmiss√£o</h4>
                        <div id="transmissao-log"></div>
                    </div>
                </div>
            </section>

            <!-- Configura√ß√µes da Empresa -->
            <section id="config-empresa" class="section">
                <h2>üè¢ Configura√ß√µes da Empresa</h2>
                
                <div class="form-container">
                    <form id="empresa-form">
                        <h3>Dados Gerais</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empresa-razao">Raz√£o Social:</label>
                                <input type="text" id="empresa-razao" value="Empresa Exemplo Ltda." required>
                            </div>
                            <div class="form-group">
                                <label for="empresa-fantasia">Nome Fantasia:</label>
                                <input type="text" id="empresa-fantasia" value="Empresa Exemplo">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empresa-cnpj">CNPJ:</label>
                                <input type="text" id="empresa-cnpj" value="12.345.678/0001-90" required>
                            </div>
                            <div class="form-group">
                                <label for="empresa-ie">Inscri√ß√£o Estadual:</label>
                                <input type="text" id="empresa-ie" value="123.456.789.012">
                            </div>
                        </div>

                        <h3>Endere√ßo</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empresa-cep">CEP:</label>
                                <input type="text" id="empresa-cep" value="01234-567">
                            </div>
                            <div class="form-group">
                                <label for="empresa-logradouro">Logradouro:</label>
                                <input type="text" id="empresa-logradouro" value="Rua Exemplo, 123">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="empresa-cidade">Cidade:</label>
                                <input type="text" id="empresa-cidade" value="S√£o Paulo">
                            </div>
                            <div class="form-group">
                                <label for="empresa-uf">UF:</label>
                                <select id="empresa-uf">
                                    <option value="SP" selected>SP - S√£o Paulo</option>
                                    <option value="RJ">RJ - Rio de Janeiro</option>
                                    <option value="MG">MG - Minas Gerais</option>
                                    <option value="RS">RS - Rio Grande do Sul</option>
                                </select>
                            </div>
                        </div>

                        <h3>Contato</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="empresa-telefone">Telefone:</label>
                                <input type="tel" id="empresa-telefone" value="(11) 1234-5678">
                            </div>
                            <div class="form-group">
                                <label for="empresa-email">E-mail:</label>
                                <input type="email" id="empresa-email" value="contato@empresaexemplo.com.br">
                            </div>
                        </div>

                        <button type="submit" class="btn">üíæ Salvar Configura√ß√µes</button>
                    </form>
                </div>
            </section>

            <!-- Configura√ß√µes do Sistema -->
            <section id="config-sistema" class="section">
                <h2>üîß Configura√ß√µes do Sistema</h2>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>üé® Personaliza√ß√£o</h3>
                        <div class="form-group">
                            <label for="tema-sistema">Tema:</label>
                            <select id="tema-sistema">
                                <option value="claro" selected>üåû Claro</option>
                                <option value="escuro">üåô Escuro</option>
                                <option value="auto">üîÑ Autom√°tico</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="idioma-sistema">Idioma:</label>
                            <select id="idioma-sistema">
                                <option value="pt-BR" selected>üáßüá∑ Portugu√™s (Brasil)</option>
                                <option value="en-US">üá∫üá∏ English (US)</option>
                                <option value="es-ES">üá™üá∏ Espa√±ol</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <h3>üìä Dashboard</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="dashboard-auto-refresh" checked>
                                Atualiza√ß√£o autom√°tica
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="dashboard-intervalo">Intervalo (segundos):</label>
                            <input type="number" id="dashboard-intervalo" value="30" min="10" max="300">
                        </div>
                    </div>

                    <div class="card">
                        <h3>üîî Notifica√ß√µes</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notif-lancamentos" checked>
                                Novos lan√ßamentos
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notif-esocial" checked>
                                Eventos e-Social
                            </label>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="notif-backup">
                                Backups autom√°ticos
                            </label>
                        </div>
                    </div>

                    <div class="card">
                        <h3>üíæ Armazenamento</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="cache-local" checked>
                                Cache local ativo
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="cache-limite">Limite do cache (MB):</label>
                            <input type="number" id="cache-limite" value="50" min="10" max="500">
                        </div>
                        <button class="btn" onclick="limparCache()">üóëÔ∏è Limpar Cache</button>
                    </div>
                </div>

                <button class="btn" onclick="salvarConfigSistema()">üíæ Salvar Configura√ß√µes</button>
            </section>

            <!-- Configura√ß√µes de Usu√°rios -->
            <section id="config-usuarios" class="section">
                <h2>üë• Gerenciar Usu√°rios</h2>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <button class="btn" onclick="abrirModalNovoUsuario()">‚ûï Novo Usu√°rio</button>
                    <button class="btn" onclick="exportarUsuarios()">üì§ Exportar Lista</button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>E-mail</th>
                                <th>Perfil</th>
                                <th>√öltimo Acesso</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="usuarios-tbody">
                            <tr>
                                <td>Administrador</td>
                                <td>admin@empresaexemplo.com.br</td>
                                <td><span class="status admin">üëë Admin</span></td>
                                <td>Agora</td>
                                <td><span class="status ativo">üü¢ Ativo</span></td>
                                <td>
                                    <button class="btn-action" onclick="editarUsuario(1)">‚úèÔ∏è</button>
                                    <button class="btn-action" onclick="bloquearUsuario(1)" disabled>üîí</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Jo√£o Silva</td>
                                <td>joao@empresaexemplo.com.br</td>
                                <td><span class="status usuario">üë§ Usu√°rio</span></td>
                                <td>Hoje 14:30</td>
                                <td><span class="status ativo">üü¢ Ativo</span></td>
                                <td>
                                    <button class="btn-action" onclick="editarUsuario(2)">‚úèÔ∏è</button>
                                    <button class="btn-action" onclick="bloquearUsuario(2)">üîí</button>
                                </td>
                            </tr>
                            <tr>
                                <td>Maria Santos</td>
                                <td>maria@empresaexemplo.com.br</td>
                                <td><span class="status contador">üìä Contador</span></td>
                                <td>Ontem 18:15</td>
                                <td><span class="status bloqueado">üî¥ Bloqueado</span></td>
                                <td>
                                    <button class="btn-action" onclick="editarUsuario(3)">‚úèÔ∏è</button>
                                    <button class="btn-action" onclick="desbloquearUsuario(3)">üîì</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Backup & Dados -->
            <section id="config-backup" class="section">
                <h2>üíæ Backup & Gest√£o de Dados</h2>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <h3>üîÑ Backup Autom√°tico</h3>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="backup-automatico" checked>
                                Ativar backup autom√°tico
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="backup-frequencia">Frequ√™ncia:</label>
                            <select id="backup-frequencia">
                                <option value="diario" selected>üìÖ Di√°rio</option>
                                <option value="semanal">üìÜ Semanal</option>
                                <option value="mensal">üóìÔ∏è Mensal</option>
                            </select>
                        </div>
                        <div class="value">√öltimo backup: Hoje 08:00</div>
                        <button class="btn" onclick="executarBackup()">üíæ Backup Agora</button>
                    </div>

                    <div class="card">
                        <h3>üì• Importar/Exportar</h3>
                        <button class="btn" onclick="exportarDados()" style="margin-bottom: 10px;">üì§ Exportar Dados</button>
                        <button class="btn" onclick="importarDados()" style="margin-bottom: 10px;">üì• Importar Dados</button>
                        <input type="file" id="arquivo-importacao" style="display: none;" accept=".json,.csv">
                    </div>

                    <div class="card">
                        <h3>üóëÔ∏è Limpeza</h3>
                        <div class="value">Logs: 156 registros (2.3 MB)</div>
                        <div class="value">Cache: 23.7 MB</div>
                        <button class="btn btn-danger" onclick="limparLogs()">üóëÔ∏è Limpar Logs</button>
                        <button class="btn" onclick="limparCache()">üßπ Limpar Cache</button>
                    </div>

                    <div class="card">
                        <h3>üìä Estat√≠sticas</h3>
                        <div class="value">Total de lan√ßamentos: 1,247</div>
                        <div class="value">Funcion√°rios ativos: 8</div>
                        <div class="value">Eventos e-Social: 156</div>
                        <div class="value">Espa√ßo usado: 15.2 MB</div>
                    </div>
                </div>
            </section>

            <!-- Configura√ß√£o do Plano de Contas -->
            <section id="config-contas" class="section">
                <h2>üè¶ Configura√ß√£o do Plano de Contas</h2>
                
                <div class="form-row" style="margin-bottom: 20px;">
                    <button class="btn" onclick="abrirModalNovaConta()">‚ûï Nova Conta</button>
                    <button class="btn" onclick="importarPlanoContas()">üì• Importar Plano</button>
                    <button class="btn" onclick="exportarPlanoContas()">üì§ Exportar Plano</button>
                    <button class="btn" onclick="restaurarPlanoDefault()">üîÑ Restaurar Padr√£o</button>
                </div>

                <div class="dashboard-cards" style="margin-bottom: 20px;">
                    <div class="card">
                        <h3>üìä Resumo das Contas</h3>
                        <div class="value" id="total-contas">0</div>
                        <small>Total de contas</small>
                    </div>
                    <div class="card">
                        <h3>üí∞ Contas Ativas</h3>
                        <div class="value" id="contas-ativas">0</div>
                        <small>Em uso no sistema</small>
                    </div>
                    <div class="card">
                        <h3>üîí Contas Inativas</h3>
                        <div class="value" id="contas-inativas">0</div>
                        <small>Desabilitadas</small>
                    </div>
                </div>

                <div class="form-row" style="margin-bottom: 20px;">
                    <div class="form-group">
                        <label for="filtro-tipo-conta">Filtrar por tipo:</label>
                        <select id="filtro-tipo-conta" onchange="filtrarContas()">
                            <option value="">Todos os tipos</option>
                            <option value="Ativo">Ativo</option>
                            <option value="Passivo">Passivo</option>
                            <option value="Receita">Receita</option>
                            <option value="Despesa">Despesa</option>
                            <option value="Patrim√¥nio">Patrim√¥nio</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="buscar-conta">Buscar conta:</label>
                        <input type="text" id="buscar-conta" placeholder="Digite c√≥digo ou nome..." onkeyup="filtrarContas()">
                    </div>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>C√≥digo</th>
                                <th>Nome da Conta</th>
                                <th>Tipo</th>
                                <th>Natureza</th>
                                <th>Status</th>
                                <th>Saldo Atual</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="config-contas-tbody">
                            <!-- Dados ser√£o inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Modal Nova Conta -->
            <div id="modal-nova-conta" class="modal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>‚ûï Nova Conta Cont√°bil</h3>
                        <button class="modal-close" onclick="fecharModalNovaConta()">‚úï</button>
                    </div>
                    <form id="form-nova-conta" onsubmit="salvarNovaConta(event)">
                        <div class="form-group">
                            <label for="nova-conta-codigo">C√≥digo da Conta:</label>
                            <input type="text" id="nova-conta-codigo" placeholder="Ex: 1.1.01" required>
                        </div>
                        <div class="form-group">
                            <label for="nova-conta-nome">Nome da Conta:</label>
                            <input type="text" id="nova-conta-nome" placeholder="Ex: Caixa" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nova-conta-tipo">Tipo:</label>
                                <select id="nova-conta-tipo" required>
                                    <option value="">Selecione...</option>
                                    <option value="Ativo">Ativo</option>
                                    <option value="Passivo">Passivo</option>
                                    <option value="Receita">Receita</option>
                                    <option value="Despesa">Despesa</option>
                                    <option value="Patrim√¥nio">Patrim√¥nio</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="nova-conta-natureza">Natureza:</label>
                                <select id="nova-conta-natureza" required>
                                    <option value="">Selecione...</option>
                                    <option value="Devedora">Devedora</option>
                                    <option value="Credora">Credora</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="nova-conta-descricao">Descri√ß√£o (opcional):</label>
                            <textarea id="nova-conta-descricao" placeholder="Descri√ß√£o detalhada da conta..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="nova-conta-ativa" checked>
                                Conta ativa
                            </label>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" onclick="fecharModalNovaConta()">Cancelar</button>
                            <button type="submit" class="btn">üíæ Salvar Conta</button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ============ FUN√á√ïES DO MENU MOBILE ============

        // Abrir/fechar menu mobile
        function toggleMobileMenu() {
            console.log('toggleMobileMenu called');
            
            const mobileMenu = document.getElementById('mobileMenu');
            const overlay = document.querySelector('.mobile-menu-overlay') || document.getElementById('mobileMenuOverlay');
            
            console.log('Elements found:', { mobileMenu: !!mobileMenu, overlay: !!overlay });
            
            if (mobileMenu && overlay) {
                const isActive = mobileMenu.classList.contains('active');
                console.log('Current state:', isActive ? 'active' : 'inactive');
                
                if (isActive) {
                    mobileMenu.classList.remove('active');
                    overlay.classList.remove('active');
                } else {
                    mobileMenu.classList.add('active');
                    overlay.classList.add('active');
                }
                
                console.log('New state:', mobileMenu.classList.contains('active') ? 'active' : 'inactive');
            } else {
                console.error('Menu elements not found!');
                alert('Erro: elementos do menu n√£o encontrados');
            }
        }

        // Fechar menu mobile
        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const overlay = document.querySelector('.mobile-menu-overlay');
            
            if (mobileMenu && overlay) {
                mobileMenu.classList.remove('active');
                overlay.classList.remove('active');
            }
        }

        // Event listeners para o menu mobile
        document.addEventListener('DOMContentLoaded', function() {
            // Fechar menu ao pressionar ESC
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeMobileMenu();
                }
            });

            // Debug: verificar se elementos existem
            console.log('Menu elements:', {
                mobileMenu: !!document.getElementById('mobileMenu'),
                overlay: !!document.querySelector('.mobile-menu-overlay'),
                hamburgerButton: !!document.querySelector('.hamburger-menu')
            });
        });

        // Fun√ß√£o para carregar dados do localStorage
        function carregarDadosLocalStorage() {
            const dados = localStorage.getItem('sistemaContabilidade');
            return dados ? JSON.parse(dados) : null;
        }

        // Fun√ß√£o para salvar dados no localStorage
        function salvarDadosLocalStorage() {
            localStorage.setItem('sistemaContabilidade', JSON.stringify(dadosCache));
        }

        // Fun√ß√£o para registrar logs de auditoria
        function registrarLog(acao, detalhes) {
            const log = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                acao: acao,
                detalhes: detalhes,
                usuario: usuarioLogado ? usuarioLogado.nome : 'Sistema'
            };
            
            dadosCache.logs.push(log);
            
            // Manter apenas os √∫ltimos 100 logs
            if (dadosCache.logs.length > 100) {
                dadosCache.logs = dadosCache.logs.slice(-100);
            }
            
            salvarDadosLocalStorage();
        }

        // Simula√ß√£o de dados em cache (backend simulado)
        let dadosCache = carregarDadosLocalStorage() || {
            lancamentos: [
                // Julho 2024
                {
                    id: 1,
                    data: '2024-07-01',
                    tipo: 'receita',
                    conta: 'banco',
                    contaCredito: 'vendas',
                    descricao: 'Venda de produtos - Cliente ABC Ltda',
                    valor: 25800.00
                },
                {
                    id: 2,
                    data: '2024-07-05',
                    tipo: 'despesa',
                    conta: 'fornecedores',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Compra de materiais de escrit√≥rio',
                    valor: 1250.00
                },
                {
                    id: 3,
                    data: '2024-07-08',
                    tipo: 'receita',
                    conta: 'caixa',
                    contaCredito: 'vendas',
                    descricao: 'Presta√ß√£o de servi√ßos - Cliente DEF S.A.',
                    valor: 18500.00
                },
                {
                    id: 4,
                    data: '2024-07-12',
                    tipo: 'despesa',
                    conta: 'banco',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Pagamento de energia el√©trica',
                    valor: 890.50
                },
                {
                    id: 5,
                    data: '2024-07-15',
                    tipo: 'receita',
                    conta: 'banco',
                    contaCredito: 'vendas',
                    descricao: 'Venda online - E-commerce',
                    valor: 32100.00
                },
                {
                    id: 6,
                    data: '2024-07-18',
                    tipo: 'despesa',
                    conta: 'banco',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Pagamento de sal√°rios',
                    valor: 15800.00
                },
                {
                    id: 7,
                    data: '2024-07-22',
                    tipo: 'receita',
                    conta: 'caixa',
                    contaCredito: 'vendas',
                    descricao: 'Venda √† vista - Loja f√≠sica',
                    valor: 8750.00
                },
                {
                    id: 8,
                    data: '2024-07-25',
                    tipo: 'despesa',
                    conta: 'fornecedores',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Compra de equipamentos de inform√°tica',
                    valor: 4200.00
                },
                
                // Agosto 2024
                {
                    id: 9,
                    data: '2024-08-01',
                    tipo: 'receita',
                    conta: 'banco',
                    contaCredito: 'vendas',
                    descricao: 'Venda de produtos - Cliente XYZ Corp',
                    valor: 28900.00
                },
                {
                    id: 10,
                    data: '2024-08-03',
                    tipo: 'despesa',
                    conta: 'banco',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Pagamento de aluguel comercial',
                    valor: 3500.00
                },
                {
                    id: 11,
                    data: '2024-08-05',
                    tipo: 'receita',
                    conta: 'caixa',
                    contaCredito: 'vendas',
                    descricao: 'Presta√ß√£o de consultoria',
                    valor: 15000.00
                },
                {
                    id: 12,
                    data: '2024-08-08',
                    tipo: 'despesa',
                    conta: 'fornecedores',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Compra de mat√©ria-prima industrial',
                    valor: 12800.00
                },
                {
                    id: 13,
                    data: '2024-08-10',
                    tipo: 'receita',
                    conta: 'banco',
                    contaCredito: 'vendas',
                    descricao: 'Venda de servi√ßos - Contrato mensal',
                    valor: 22500.00
                },
                {
                    id: 14,
                    data: '2024-08-12',
                    tipo: 'despesa',
                    conta: 'banco',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Pagamento de telefone e internet',
                    valor: 650.00
                },
                {
                    id: 15,
                    data: '2024-08-15',
                    tipo: 'receita',
                    conta: 'caixa',
                    contaCredito: 'vendas',
                    descricao: 'Venda √† vista - Produtos diversos',
                    valor: 9800.00
                },
                {
                    id: 16,
                    data: '2024-08-18',
                    tipo: 'despesa',
                    conta: 'banco',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Manuten√ß√£o de equipamentos',
                    valor: 2100.00
                },
                {
                    id: 17,
                    data: '2024-08-20',
                    tipo: 'receita',
                    conta: 'banco',
                    contaCredito: 'vendas',
                    descricao: 'Venda de produtos importados',
                    valor: 35600.00
                },
                {
                    id: 18,
                    data: '2024-08-22',
                    tipo: 'despesa',
                    conta: 'fornecedores',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Compra de combust√≠vel - Frota',
                    valor: 1800.00
                },
                {
                    id: 19,
                    data: '2024-08-25',
                    tipo: 'receita',
                    conta: 'caixa',
                    contaCredito: 'vendas',
                    descricao: 'Presta√ß√£o de servi√ßos t√©cnicos',
                    valor: 12300.00
                },
                {
                    id: 20,
                    data: '2024-08-28',
                    tipo: 'despesa',
                    conta: 'banco',
                    contaDebito: 'despesas-operacionais',
                    descricao: 'Pagamento de impostos municipais',
                    valor: 3200.00
                }
            ],
            contas: [
                // ATIVO CIRCULANTE
                {
                    codigo: '1.1.01',
                    nome: 'Caixa',
                    tipo: 'Ativo Circulante',
                    natureza: 'devedora',
                    saldo: 45850.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.1.02',
                    nome: 'Banco Conta Corrente - Bradesco',
                    tipo: 'Ativo Circulante',
                    natureza: 'devedora',
                    saldo: 125400.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.1.03',
                    nome: 'Banco Conta Corrente - Ita√∫',
                    tipo: 'Ativo Circulante',
                    natureza: 'devedora',
                    saldo: 89200.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.1.04',
                    nome: 'Aplica√ß√µes Financeiras',
                    tipo: 'Ativo Circulante',
                    natureza: 'devedora',
                    saldo: 75000.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.1.05',
                    nome: 'Contas a Receber - Clientes',
                    tipo: 'Ativo Circulante',
                    natureza: 'devedora',
                    saldo: 48500.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.1.06',
                    nome: 'Estoque de Produtos',
                    tipo: 'Ativo Circulante',
                    natureza: 'devedora',
                    saldo: 65200.00,
                    status: 'Ativo'
                },
                
                // ATIVO N√ÉO CIRCULANTE
                {
                    codigo: '1.2.01',
                    nome: 'Im√≥veis',
                    tipo: 'Ativo N√£o Circulante',
                    natureza: 'devedora',
                    saldo: 450000.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.2.02',
                    nome: 'M√≥veis e Utens√≠lios',
                    tipo: 'Ativo N√£o Circulante',
                    natureza: 'devedora',
                    saldo: 25800.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.2.03',
                    nome: 'Equipamentos de Inform√°tica',
                    tipo: 'Ativo N√£o Circulante',
                    natureza: 'devedora',
                    saldo: 18600.00,
                    status: 'Ativo'
                },
                {
                    codigo: '1.2.04',
                    nome: 'Ve√≠culos',
                    tipo: 'Ativo N√£o Circulante',
                    natureza: 'devedora',
                    saldo: 85000.00,
                    status: 'Ativo'
                },
                
                // PASSIVO CIRCULANTE
                {
                    codigo: '2.1.01',
                    nome: 'Fornecedores',
                    tipo: 'Passivo Circulante',
                    natureza: 'credora',
                    saldo: 32500.00,
                    status: 'Ativo'
                },
                {
                    codigo: '2.1.02',
                    nome: 'Sal√°rios a Pagar',
                    tipo: 'Passivo Circulante',
                    natureza: 'credora',
                    saldo: 18900.00,
                    status: 'Ativo'
                },
                {
                    codigo: '2.1.03',
                    nome: 'INSS a Recolher',
                    tipo: 'Passivo Circulante',
                    natureza: 'credora',
                    saldo: 3200.00,
                    status: 'Ativo'
                },
                {
                    codigo: '2.1.04',
                    nome: 'FGTS a Recolher',
                    tipo: 'Passivo Circulante',
                    natureza: 'credora',
                    saldo: 1890.00,
                    status: 'Ativo'
                },
                {
                    codigo: '2.1.05',
                    nome: 'ICMS a Recolher',
                    tipo: 'Passivo Circulante',
                    natureza: 'credora',
                    saldo: 8222.40,
                    status: 'Ativo'
                },
                {
                    codigo: '2.1.06',
                    nome: 'PIS a Recolher',
                    tipo: 'Passivo Circulante',
                    natureza: 'credora',
                    saldo: 753.72,
                    status: 'Ativo'
                },
                
                // PATRIM√îNIO L√çQUIDO
                {
                    codigo: '2.2.01',
                    nome: 'Capital Social',
                    tipo: 'Patrim√¥nio L√≠quido',
                    natureza: 'credora',
                    saldo: 100000.00,
                    status: 'Ativo'
                },
                {
                    codigo: '2.2.02',
                    nome: 'Reservas de Lucros',
                    tipo: 'Patrim√¥nio L√≠quido',
                    natureza: 'credora',
                    saldo: 125600.00,
                    status: 'Ativo'
                },
                {
                    codigo: '2.2.03',
                    nome: 'Lucros Acumulados',
                    tipo: 'Patrim√¥nio L√≠quido',
                    natureza: 'credora',
                    saldo: 89450.00,
                    status: 'Ativo'
                },
                
                // RECEITAS
                {
                    codigo: '3.1.01',
                    nome: 'Receitas de Vendas',
                    tipo: 'Receita',
                    natureza: 'credora',
                    saldo: 180350.00,
                    status: 'Ativo'
                },
                {
                    codigo: '3.1.02',
                    nome: 'Receitas de Servi√ßos',
                    tipo: 'Receita',
                    natureza: 'credora',
                    saldo: 95800.00,
                    status: 'Ativo'
                },
                {
                    codigo: '3.2.01',
                    nome: 'Receitas Financeiras',
                    tipo: 'Receita',
                    natureza: 'credora',
                    saldo: 5450.00,
                    status: 'Ativo'
                },
                
                // DESPESAS
                {
                    codigo: '4.1.01',
                    nome: 'Sal√°rios e Encargos',
                    tipo: 'Despesa',
                    natureza: 'devedora',
                    saldo: 89600.00,
                    status: 'Ativo'
                },
                {
                    codigo: '4.1.02',
                    nome: 'Aluguel',
                    tipo: 'Despesa',
                    natureza: 'devedora',
                    saldo: 21000.00,
                    status: 'Ativo'
                },
                {
                    codigo: '4.1.03',
                    nome: 'Energia El√©trica',
                    tipo: 'Despesa',
                    natureza: 'devedora',
                    saldo: 5340.00,
                    status: 'Ativo'
                },
                {
                    codigo: '4.1.04',
                    nome: 'Telefone e Internet',
                    tipo: 'Despesa',
                    natureza: 'devedora',
                    saldo: 3900.00,
                    status: 'Ativo'
                },
                {
                    codigo: '4.1.05',
                    nome: 'Material de Escrit√≥rio',
                    tipo: 'Despesa',
                    natureza: 'devedora',
                    saldo: 7500.00,
                    status: 'Ativo'
                },
                {
                    codigo: '4.1.06',
                    nome: 'Combust√≠vel',
                    tipo: 'Despesa',
                    natureza: 'devedora',
                    saldo: 10800.00,
                    status: 'Ativo'
                },
                {
                    codigo: '4.1.07',
                    nome: 'Manuten√ß√£o e Conserva√ß√£o',
                    tipo: 'Despesa',
                    natureza: 'devedora',
                    saldo: 12600.00,
                    status: 'Ativo'
                }
            ],
            contasPagarReceber: [
                // CONTAS A RECEBER
                {
                    id: 1,
                    tipo: 'receber',
                    vencimento: '2024-08-15',
                    cliente: 'ABC Com√©rcio Ltda',
                    descricao: 'Venda de produtos eletr√¥nicos - NF 1001',
                    valor: 18500.00,
                    status: 'pendente'
                },
                {
                    id: 2,
                    tipo: 'receber',
                    vencimento: '2024-08-20',
                    cliente: 'DEF Ind√∫stria S.A.',
                    descricao: 'Presta√ß√£o de servi√ßos t√©cnicos - NF 1002',
                    valor: 25000.00,
                    status: 'pendente'
                },
                {
                    id: 3,
                    tipo: 'receber',
                    vencimento: '2024-08-25',
                    cliente: 'GHI Construtora Ltda',
                    descricao: 'Fornecimento de materiais - NF 1003',
                    valor: 32800.00,
                    status: 'pendente'
                },
                {
                    id: 4,
                    tipo: 'receber',
                    vencimento: '2024-09-05',
                    cliente: 'JKL Empreendimentos',
                    descricao: 'Consultoria empresarial - NF 1004',
                    valor: 12500.00,
                    status: 'pendente'
                },
                {
                    id: 5,
                    tipo: 'receber',
                    vencimento: '2024-09-10',
                    cliente: 'MNO Atacado Ltda',
                    descricao: 'Venda de produtos diversos - NF 1005',
                    valor: 28900.00,
                    status: 'pendente'
                },
                {
                    id: 6,
                    tipo: 'receber',
                    vencimento: '2024-08-05',
                    cliente: 'PQR Com√©rcio S.A.',
                    descricao: 'Venda √† prazo - NF 0999',
                    valor: 15800.00,
                    status: 'vencida'
                },
                {
                    id: 7,
                    tipo: 'receber',
                    vencimento: '2024-07-30',
                    cliente: 'STU Distribuidora',
                    descricao: 'Fornecimento mensal - NF 0998',
                    valor: 22400.00,
                    status: 'vencida'
                },

                // CONTAS A PAGAR
                {
                    id: 8,
                    tipo: 'pagar',
                    vencimento: '2024-08-10',
                    cliente: 'Energia El√©trica - CEMIG',
                    descricao: 'Conta de energia - Agosto/2024',
                    valor: 1250.00,
                    status: 'vencida'
                },
                {
                    id: 9,
                    tipo: 'pagar',
                    vencimento: '2024-08-12',
                    cliente: 'Fornecedor Alpha Ltda',
                    descricao: 'Compra de mat√©ria-prima - NF 5001',
                    valor: 18900.00,
                    status: 'pendente'
                },
                {
                    id: 10,
                    tipo: 'pagar',
                    vencimento: '2024-08-15',
                    cliente: 'Beta Equipamentos S.A.',
                    descricao: 'Manuten√ß√£o de m√°quinas - OS 2024-08',
                    valor: 4500.00,
                    status: 'pendente'
                },
                {
                    id: 11,
                    tipo: 'pagar',
                    vencimento: '2024-08-18',
                    cliente: 'Gama Transportes',
                    descricao: 'Frete de mercadorias - Julho/2024',
                    valor: 2800.00,
                    status: 'pendente'
                },
                {
                    id: 12,
                    tipo: 'pagar',
                    vencimento: '2024-08-20',
                    cliente: 'Delta Servi√ßos Ltda',
                    descricao: 'Servi√ßos de limpeza - Agosto/2024',
                    valor: 1200.00,
                    status: 'pendente'
                },
                {
                    id: 13,
                    tipo: 'pagar',
                    vencimento: '2024-08-25',
                    cliente: 'Epsilon Inform√°tica',
                    descricao: 'Suporte t√©cnico mensal - Agosto/2024',
                    valor: 850.00,
                    status: 'pendente'
                },
                {
                    id: 14,
                    tipo: 'pagar',
                    vencimento: '2024-09-01',
                    cliente: 'Imobili√°ria Zeta',
                    descricao: 'Aluguel comercial - Setembro/2024',
                    valor: 5500.00,
                    status: 'pendente'
                },
                {
                    id: 15,
                    tipo: 'pagar',
                    vencimento: '2024-09-05',
                    cliente: 'Theta Combust√≠veis',
                    descricao: 'Abastecimento da frota - Agosto/2024',
                    valor: 3200.00,
                    status: 'pendente'
                },
                {
                    id: 16,
                    tipo: 'pagar',
                    vencimento: '2024-08-08',
                    cliente: 'Iota Seguros S.A.',
                    descricao: 'Seguro empresarial - Parcela 08/12',
                    valor: 2100.00,
                    status: 'vencida'
                },
                {
                    id: 17,
                    tipo: 'pagar',
                    vencimento: '2024-07-28',
                    cliente: 'Kappa Materiais',
                    descricao: 'Compra de materiais de escrit√≥rio',
                    valor: 680.00,
                    status: 'vencida'
                },
                {
                    id: 18,
                    tipo: 'pagar',
                    vencimento: '2024-08-30',
                    cliente: 'Lambda Contabilidade',
                    descricao: 'Honor√°rios cont√°beis - Agosto/2024',
                    valor: 1800.00,
                    status: 'pendente'
                }
            ],
            logs: [
                {
                    id: 1,
                    timestamp: '2024-08-01T08:30:00.000Z',
                    acao: 'LANCAMENTO_CRIADO',
                    detalhes: 'Novo lan√ßamento: receita - Venda de produtos - Cliente XYZ Corp - R$ 28900',
                    usuario: 'Jo√£o Silva Santos'
                },
                {
                    id: 2,
                    timestamp: '2024-08-01T09:15:00.000Z',
                    acao: 'IMPOSTO_APURADO',
                    detalhes: 'ICMS apurado: 2024-08 - R$ 27738.00',
                    usuario: 'Maria Oliveira Costa'
                },
                {
                    id: 3,
                    timestamp: '2024-08-02T10:20:00.000Z',
                    acao: 'FUNCIONARIO_CADASTRADO',
                    detalhes: 'Novo funcion√°rio: Alexandre Vieira Santos - Auxiliar de Limpeza',
                    usuario: 'Larissa Mendes Oliveira'
                },
                {
                    id: 4,
                    timestamp: '2024-08-03T11:45:00.000Z',
                    acao: 'LANCAMENTO_CRIADO',
                    detalhes: 'Novo lan√ßamento: despesa - Pagamento de aluguel comercial - R$ 3500',
                    usuario: 'Pedro Henrique Lima'
                },
                {
                    id: 5,
                    timestamp: '2024-08-05T14:30:00.000Z',
                    acao: 'CONTA_CRIADA',
                    detalhes: 'Nova conta receber: ABC Com√©rcio Ltda - R$ 18500',
                    usuario: 'Ana Carolina Ferreira'
                },
                {
                    id: 6,
                    timestamp: '2024-08-08T16:10:00.000Z',
                    acao: 'FOLHA_PROCESSADA',
                    detalhes: 'Folha processada para 2024-08 - 15 funcion√°rios',
                    usuario: 'Larissa Mendes Oliveira'
                },
                {
                    id: 7,
                    timestamp: '2024-08-10T09:25:00.000Z',
                    acao: 'SPED_GERADO',
                    detalhes: 'SPED Fiscal gerado para per√≠odo 2024-08',
                    usuario: 'Jo√£o Silva Santos'
                },
                {
                    id: 8,
                    timestamp: '2024-08-12T13:40:00.000Z',
                    acao: 'IMPOSTO_APURADO',
                    detalhes: 'PIS apurado: 2024-08 - R$ 2542.65',
                    usuario: 'Maria Oliveira Costa'
                },
                {
                    id: 9,
                    timestamp: '2024-08-15T08:55:00.000Z',
                    acao: 'LANCAMENTO_CRIADO',
                    detalhes: 'Novo lan√ßamento: receita - Venda √† vista - Produtos diversos - R$ 9800',
                    usuario: 'Carlos Eduardo Rodrigues'
                },
                {
                    id: 10,
                    timestamp: '2024-08-18T15:20:00.000Z',
                    acao: 'CONTA_CRIADA',
                    detalhes: 'Nova conta pagar: Beta Equipamentos S.A. - R$ 4500',
                    usuario: 'Roberto Martins Silva'
                },
                {
                    id: 11,
                    timestamp: '2024-08-20T11:35:00.000Z',
                    acao: 'FUNCIONARIO_DESLIGADO',
                    detalhes: 'Funcion√°rio desligado: Lucas Teixeira Dias',
                    usuario: 'Larissa Mendes Oliveira'
                },
                {
                    id: 12,
                    timestamp: '2024-08-22T16:45:00.000Z',
                    acao: 'IMPOSTO_APURADO',
                    detalhes: 'COFINS apurado: 2024-08 - R$ 11711.60',
                    usuario: 'Maria Oliveira Costa'
                },
                {
                    id: 13,
                    timestamp: '2024-08-25T10:15:00.000Z',
                    acao: 'LANCAMENTO_CRIADO',
                    detalhes: 'Novo lan√ßamento: receita - Presta√ß√£o de servi√ßos t√©cnicos - R$ 12300',
                    usuario: 'Beatriz Fernandes Cruz'
                },
                {
                    id: 14,
                    timestamp: '2024-08-28T14:50:00.000Z',
                    acao: 'CONTA_EXCLUIDA',
                    detalhes: 'Conta exclu√≠da: pagar - Fornecedor Teste - R$ 500',
                    usuario: 'Jo√£o Silva Santos'
                },
                {
                    id: 15,
                    timestamp: '2024-08-30T09:30:00.000Z',
                    acao: 'SPED_GERADO',
                    detalhes: 'SPED Fiscal gerado para per√≠odo 2024-07',
                    usuario: 'Pedro Henrique Lima'
                }
            ],
            impostos: [
                // Junho 2024
                {
                    id: 1,
                    tipo: 'icms',
                    periodo: '2024-06',
                    baseCalculo: 38500.00,
                    aliquota: 18.00,
                    valor: 6930.00,
                    status: 'recolhido'
                },
                {
                    id: 2,
                    tipo: 'pis',
                    periodo: '2024-06',
                    baseCalculo: 38500.00,
                    aliquota: 1.65,
                    valor: 635.25,
                    status: 'recolhido'
                },
                {
                    id: 3,
                    tipo: 'cofins',
                    periodo: '2024-06',
                    baseCalculo: 38500.00,
                    aliquota: 7.60,
                    valor: 2926.00,
                    status: 'recolhido'
                },
                {
                    id: 4,
                    tipo: 'irpj',
                    periodo: '2024-06',
                    baseCalculo: 8500.00,
                    aliquota: 15.00,
                    valor: 1275.00,
                    status: 'recolhido'
                },
                
                // Julho 2024
                {
                    id: 5,
                    tipo: 'icms',
                    periodo: '2024-07',
                    baseCalculo: 85150.00,
                    aliquota: 18.00,
                    valor: 15327.00,
                    status: 'recolhido'
                },
                {
                    id: 6,
                    tipo: 'pis',
                    periodo: '2024-07',
                    baseCalculo: 85150.00,
                    aliquota: 1.65,
                    valor: 1404.98,
                    status: 'recolhido'
                },
                {
                    id: 7,
                    tipo: 'cofins',
                    periodo: '2024-07',
                    baseCalculo: 85150.00,
                    aliquota: 7.60,
                    valor: 6471.40,
                    status: 'recolhido'
                },
                {
                    id: 8,
                    tipo: 'ipi',
                    periodo: '2024-07',
                    baseCalculo: 45800.00,
                    aliquota: 5.00,
                    valor: 2290.00,
                    status: 'recolhido'
                },
                {
                    id: 9,
                    tipo: 'irpj',
                    periodo: '2024-07',
                    baseCalculo: 18600.00,
                    aliquota: 15.00,
                    valor: 2790.00,
                    status: 'recolhido'
                },
                {
                    id: 10,
                    tipo: 'csll',
                    periodo: '2024-07',
                    baseCalculo: 18600.00,
                    aliquota: 9.00,
                    valor: 1674.00,
                    status: 'recolhido'
                },
                
                // Agosto 2024
                {
                    id: 11,
                    tipo: 'icms',
                    periodo: '2024-08',
                    baseCalculo: 154100.00,
                    aliquota: 18.00,
                    valor: 27738.00,
                    status: 'apurado'
                },
                {
                    id: 12,
                    tipo: 'pis',
                    periodo: '2024-08',
                    baseCalculo: 154100.00,
                    aliquota: 1.65,
                    valor: 2542.65,
                    status: 'apurado'
                },
                {
                    id: 13,
                    tipo: 'cofins',
                    periodo: '2024-08',
                    baseCalculo: 154100.00,
                    aliquota: 7.60,
                    valor: 11711.60,
                    status: 'apurado'
                },
                {
                    id: 14,
                    tipo: 'ipi',
                    periodo: '2024-08',
                    baseCalculo: 89200.00,
                    aliquota: 5.00,
                    valor: 4460.00,
                    status: 'apurado'
                },
                {
                    id: 15,
                    tipo: 'irpj',
                    periodo: '2024-08',
                    baseCalculo: 42500.00,
                    aliquota: 15.00,
                    valor: 6375.00,
                    status: 'apurado'
                },
                {
                    id: 16,
                    tipo: 'csll',
                    periodo: '2024-08',
                    baseCalculo: 42500.00,
                    aliquota: 9.00,
                    valor: 3825.00,
                    status: 'apurado'
                }
            ],
            funcionarios: [
                {
                    id: 1,
                    nome: 'Jo√£o Silva Santos',
                    cpf: '123.456.789-00',
                    cargo: 'Gerente Financeiro',
                    departamento: 'financeiro',
                    salarioBruto: 8500.00,
                    dataAdmissao: '2022-03-15',
                    ativo: true,
                    // Dados e-Social
                    pis: '12345678901',
                    ctps: '1234567/001',
                    rg: '12.345.678-9',
                    dataNascimento: '1985-05-10',
                    estadoCivil: 'casado',
                    endereco: {
                        cep: '01234-567',
                        logradouro: 'Rua das Flores, 123',
                        bairro: 'Centro',
                        cidade: 'S√£o Paulo',
                        uf: 'SP'
                    },
                    categoriaESocial: '101', // Empregado geral
                    matricula: 'EMP001',
                    vinculo: 'clt'
                },
                {
                    id: 2,
                    nome: 'Maria Oliveira Costa',
                    cpf: '987.654.321-00',
                    cargo: 'Analista Cont√°bil Senior',
                    departamento: 'financeiro',
                    salarioBruto: 6200.00,
                    dataAdmissao: '2023-01-10',
                    ativo: true,
                    // Dados e-Social
                    pis: '98765432109',
                    ctps: '9876543/002',
                    rg: '98.765.432-1',
                    dataNascimento: '1990-08-22',
                    estadoCivil: 'solteira',
                    endereco: {
                        cep: '02345-678',
                        logradouro: 'Av. Paulista, 456',
                        bairro: 'Bela Vista',
                        cidade: 'S√£o Paulo',
                        uf: 'SP'
                    },
                    categoriaESocial: '101', // Empregado geral
                    matricula: 'EMP002',
                    vinculo: 'clt'
                },
                {
                    id: 3,
                    nome: 'Pedro Henrique Lima',
                    cpf: '456.789.123-00',
                    cargo: 'Assistente Cont√°bil',
                    departamento: 'financeiro',
                    salarioBruto: 3800.00,
                    dataAdmissao: '2024-02-20',
                    ativo: true
                },
                {
                    id: 4,
                    nome: 'Ana Carolina Ferreira',
                    cpf: '789.123.456-00',
                    cargo: 'Coordenadora de Vendas',
                    departamento: 'vendas',
                    salarioBruto: 7200.00,
                    dataAdmissao: '2022-08-05',
                    ativo: true
                },
                {
                    id: 5,
                    nome: 'Carlos Eduardo Rodrigues',
                    cpf: '321.654.987-00',
                    cargo: 'Vendedor Senior',
                    departamento: 'vendas',
                    salarioBruto: 4800.00,
                    dataAdmissao: '2023-04-12',
                    ativo: true
                },
                {
                    id: 6,
                    nome: 'Fernanda Alves Pereira',
                    cpf: '654.987.321-00',
                    cargo: 'Vendedora Junior',
                    departamento: 'vendas',
                    salarioBruto: 3200.00,
                    dataAdmissao: '2024-01-08',
                    ativo: true
                },
                {
                    id: 7,
                    nome: 'Roberto Martins Silva',
                    cpf: '147.258.369-00',
                    cargo: 'Supervisor de Produ√ß√£o',
                    departamento: 'producao',
                    salarioBruto: 6500.00,
                    dataAdmissao: '2021-11-22',
                    ativo: true
                },
                {
                    id: 8,
                    nome: 'Juliana Santos Barbosa',
                    cpf: '258.369.147-00',
                    cargo: 'Operadora de Produ√ß√£o',
                    departamento: 'producao',
                    salarioBruto: 2800.00,
                    dataAdmissao: '2023-07-15',
                    ativo: true
                },
                {
                    id: 9,
                    nome: 'Marcos Antonio Souza',
                    cpf: '369.147.258-00',
                    cargo: 'Auxiliar de Produ√ß√£o',
                    departamento: 'producao',
                    salarioBruto: 2200.00,
                    dataAdmissao: '2024-03-18',
                    ativo: true
                },
                {
                    id: 10,
                    nome: 'Larissa Mendes Oliveira',
                    cpf: '741.852.963-00',
                    cargo: 'Analista de RH',
                    departamento: 'rh',
                    salarioBruto: 5200.00,
                    dataAdmissao: '2023-02-28',
                    ativo: true
                },
                {
                    id: 11,
                    nome: 'Ricardo Gomes Carvalho',
                    cargo: 'Auxiliar Administrativo',
                    cpf: '852.963.741-00',
                    departamento: 'administrativo',
                    salarioBruto: 2600.00,
                    dataAdmissao: '2023-09-14',
                    ativo: true
                },
                {
                    id: 12,
                    nome: 'Camila Rocha Nascimento',
                    cpf: '963.741.852-00',
                    cargo: 'Recepcionista',
                    departamento: 'administrativo',
                    salarioBruto: 2000.00,
                    dataAdmissao: '2024-01-22',
                    ativo: true
                },
                {
                    id: 13,
                    nome: 'Daniel Costa Moreira',
                    cpf: '159.753.486-00',
                    cargo: 'Motorista',
                    departamento: 'administrativo',
                    salarioBruto: 2400.00,
                    dataAdmissao: '2023-06-08',
                    ativo: true
                },
                {
                    id: 14,
                    nome: 'Beatriz Fernandes Cruz',
                    cpf: '753.486.159-00',
                    cargo: 'Analista de TI',
                    departamento: 'administrativo',
                    salarioBruto: 6800.00,
                    dataAdmissao: '2022-12-03',
                    ativo: true
                },
                {
                    id: 15,
                    nome: 'Alexandre Vieira Santos',
                    cpf: '486.159.753-00',
                    cargo: 'Auxiliar de Limpeza',
                    departamento: 'administrativo',
                    salarioBruto: 1800.00,
                    dataAdmissao: '2024-04-10',
                    ativo: true
                },
                // Funcion√°rios desligados
                {
                    id: 16,
                    nome: 'Lucas Teixeira Dias',
                    cpf: '852.741.963-00',
                    cargo: 'Ex-Vendedor',
                    departamento: 'vendas',
                    salarioBruto: 3500.00,
                    dataAdmissao: '2023-01-05',
                    ativo: false
                },
                {
                    id: 17,
                    nome: 'Patr√≠cia Lima Ramos',
                    cpf: '741.963.852-00',
                    cargo: 'Ex-Auxiliar Cont√°bil',
                    departamento: 'financeiro',
                    salarioBruto: 3200.00,
                    dataAdmissao: '2023-03-12',
                    ativo: false
                }
            ],
            eventosESocial: [
                {
                    id: 1,
                    tipo: 'S-1200',
                    funcionarioId: 1,
                    funcionarioNome: 'Jo√£o Silva Santos',
                    periodo: '2024-08',
                    status: 'processado',
                    dataCriacao: '2024-08-31T10:30:00.000Z',
                    protocolo: 'ES240831001'
                },
                {
                    id: 2,
                    tipo: 'S-1200',
                    funcionarioId: 2,
                    funcionarioNome: 'Maria Oliveira Costa',
                    periodo: '2024-08',
                    status: 'processado',
                    dataCriacao: '2024-08-31T10:35:00.000Z',
                    protocolo: 'ES240831002'
                },
                {
                    id: 3,
                    tipo: 'S-2200',
                    funcionarioId: 15,
                    funcionarioNome: 'Alexandre Vieira Santos',
                    periodo: '2024-08',
                    status: 'pendente',
                    dataCriacao: '2024-08-30T14:20:00.000Z',
                    protocolo: null
                }
            ],
            remuneracaoESocial: [
                {
                    id: 1,
                    funcionarioId: 1,
                    funcionarioNome: 'Jo√£o Silva Santos',
                    periodo: '2024-08',
                    salarioBase: 8500.00,
                    proventos: 8500.00,
                    descontos: 1530.00,
                    statusS1200: 'enviado'
                },
                {
                    id: 2,
                    funcionarioId: 2,
                    funcionarioNome: 'Maria Oliveira Costa',
                    periodo: '2024-08',
                    salarioBase: 6200.00,
                    proventos: 6200.00,
                    descontos: 1085.00,
                    statusS1200: 'enviado'
                }
            ]
        };

        // Fun√ß√£o para alternar entre se√ß√µes
        function showSection(sectionName) {
            // Verificar se o usu√°rio est√° logado
            if (!usuarioLogado) {
                mostrarNotificacao('‚ö†Ô∏è Voc√™ precisa fazer login para acessar esta se√ß√£o!', 'warning');
                return;
            }

            // Remover classe active de todas as se√ß√µes e bot√µes
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('active');
            });

            // Adicionar classe active na se√ß√£o selecionada
            document.getElementById(sectionName).classList.add('active');
            
            // Adicionar classe active no item do menu correspondente
            if (event && event.target) {
                if (event.target.classList.contains('dropdown-item')) {
                    event.target.classList.add('active');
                } else if (event.target.classList.contains('nav-btn')) {
                    event.target.classList.add('active');
                }
            }

            // Carregar dados espec√≠ficos da se√ß√£o
            if (sectionName === 'lancamentos') {
                carregarLancamentos();
            } else if (sectionName === 'contas') {
                carregarContas();
            } else if (sectionName === 'dashboard') {
                atualizarDashboard();
            } else if (sectionName === 'diario') {
                carregarDiario();
            } else if (sectionName === 'razao') {
                carregarRazao();
            } else if (sectionName === 'contasreceber') {
                carregarContasReceber();
            } else if (sectionName === 'fiscal') {
                carregarModuloFiscal();
            } else if (sectionName === 'sped') {
                carregarSpedFiscal();
            } else if (sectionName === 'folha') {
                carregarFolhaPagamento();
            } else if (sectionName === 'esocial') {
                carregarESocial();
            } else if (sectionName === 'config-contas') {
                carregarConfigContas();
            }
        }

        // Carregar lan√ßamentos na tabela
        function carregarLancamentos() {
            const tbody = document.getElementById('lancamentos-tbody');
            tbody.innerHTML = '';

            dadosCache.lancamentos.forEach(lancamento => {
                const row = document.createElement('tr');
                const dataFormatada = new Date(lancamento.data).toLocaleDateString('pt-BR');
                const valorFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(lancamento.valor);

                row.innerHTML = `
                    <td>${dataFormatada}</td>
                    <td><span class="status ${lancamento.tipo}">${lancamento.tipo}</span></td>
                    <td>${lancamento.conta}</td>
                    <td>${lancamento.descricao}</td>
                    <td>${valorFormatado}</td>
                    <td>
                        <button class="btn btn-danger" onclick="excluirLancamento(${lancamento.id})">
                            Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Carregar contas na tabela
        function carregarContas() {
            const tbody = document.getElementById('contas-tbody');
            tbody.innerHTML = '';

            dadosCache.contas.forEach(conta => {
                const row = document.createElement('tr');
                const saldoFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(conta.saldo);

                row.innerHTML = `
                    <td>${conta.codigo}</td>
                    <td>${conta.nome}</td>
                    <td>${conta.tipo}</td>
                    <td>${saldoFormatado}</td>
                    <td><span class="status pago">${conta.status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Adicionar novo lan√ßamento
        document.getElementById('lancamento-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const novoLancamento = {
                id: Date.now(),
                data: document.getElementById('data').value,
                tipo: document.getElementById('tipo').value,
                conta: document.getElementById('conta').value,
                descricao: document.getElementById('descricao').value,
                valor: parseFloat(document.getElementById('valor').value)
            };

            dadosCache.lancamentos.unshift(novoLancamento);
            
            // Registrar log de auditoria
            registrarLog('LANCAMENTO_CRIADO', `Novo lan√ßamento: ${novoLancamento.tipo} - ${novoLancamento.descricao} - R$ ${novoLancamento.valor}`);
            
            // Salvar no localStorage
            salvarDadosLocalStorage();
            
            // Limpar formul√°rio
            this.reset();
            
            // Recarregar tabela
            carregarLancamentos();
            
            // Atualizar dashboard
            atualizarDashboard();

            alert('Lan√ßamento adicionado com sucesso!');
        });

        // Excluir lan√ßamento
        function excluirLancamento(id) {
            if (confirm('Tem certeza que deseja excluir este lan√ßamento?')) {
                const lancamentoExcluido = dadosCache.lancamentos.find(l => l.id === id);
                dadosCache.lancamentos = dadosCache.lancamentos.filter(l => l.id !== id);
                
                // Registrar log de auditoria
                if (lancamentoExcluido) {
                    registrarLog('LANCAMENTO_EXCLUIDO', `Lan√ßamento exclu√≠do: ${lancamentoExcluido.descricao} - R$ ${lancamentoExcluido.valor}`);
                }
                
                salvarDadosLocalStorage();
                carregarLancamentos();
                atualizarDashboard();
                alert('Lan√ßamento exclu√≠do com sucesso!');
            }
        }

        // Atualizar dashboard
        function atualizarDashboard() {
            const receitas = dadosCache.lancamentos
                .filter(l => l.tipo === 'receita')
                .reduce((sum, l) => sum + l.valor, 0);
            
            const despesas = dadosCache.lancamentos
                .filter(l => l.tipo === 'despesa')
                .reduce((sum, l) => sum + l.valor, 0);

            const lucro = receitas - despesas;
            const saldoCaixa = lucro + 74690; // Saldo inicial simulado

            document.getElementById('receitas-mes').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(receitas);
            
            document.getElementById('despesas-mes').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(despesas);
            
            document.getElementById('lucro-liquido').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(lucro);
            
            document.getElementById('saldo-caixa').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(saldoCaixa);

            // Desenhar gr√°fico simples
            desenharGrafico();
            
            // Inicializar interatividade do gr√°fico apenas uma vez
            if (!window.graficoInteratividadeIniciada) {
                setTimeout(() => {
                    adicionarInteratividadeGrafico();
                    window.graficoInteratividadeIniciada = true;
                }, 100);
            }
        }

        // Desenhar gr√°fico de fluxo de caixa aprimorado
        function desenharGrafico() {
            const canvas = document.getElementById('fluxoCaixaChart');
            const ctx = canvas.getContext('2d');
            
            // Ajustar canvas para alta resolu√ß√£o
            const rect = canvas.getBoundingClientRect();
            const devicePixelRatio = window.devicePixelRatio || 1;
            canvas.width = rect.width * devicePixelRatio;
            canvas.height = rect.height * devicePixelRatio;
            ctx.scale(devicePixelRatio, devicePixelRatio);
            
            // Limpar canvas
            ctx.clearRect(0, 0, rect.width, rect.height);
            
            // Calcular dados baseados nos lan√ßamentos reais
            const dadosFluxo = calcularDadosFluxo();
            const { meses, receitas, despesas, saldos } = dadosFluxo;
            
            // Armazenar dados globalmente para interatividade
            dadosGraficoGlobal = dadosFluxo;
            
            const padding = 60;
            const chartWidth = rect.width - 2 * padding;
            const chartHeight = rect.height - 2 * padding;
            const maxValue = Math.max(...saldos, ...receitas, ...despesas);
            const minValue = Math.min(...saldos, 0);
            const valueRange = maxValue - minValue;
            
            // Fun√ß√£o para calcular posi√ß√£o Y
            function getY(value) {
                return rect.height - padding - ((value - minValue) / valueRange * chartHeight);
            }
            
            // Desenhar grid
            ctx.strokeStyle = 'rgba(200, 200, 200, 0.3)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 5; i++) {
                const y = padding + (i * chartHeight / 5);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(rect.width - padding, y);
                ctx.stroke();
            }
            
            // Desenhar eixos
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, rect.height - padding);
            ctx.lineTo(rect.width - padding, rect.height - padding);
            ctx.stroke();
            
            // √Årea de receitas (verde)
            ctx.fillStyle = 'rgba(40, 167, 69, 0.2)';
            ctx.beginPath();
            ctx.moveTo(padding, getY(0));
            receitas.forEach((valor, index) => {
                const x = padding + (index * chartWidth / (receitas.length - 1));
                ctx.lineTo(x, getY(valor));
            });
            ctx.lineTo(rect.width - padding, getY(0));
            ctx.closePath();
            ctx.fill();
            
            // √Årea de despesas (vermelho)
            ctx.fillStyle = 'rgba(220, 53, 69, 0.2)';
            ctx.beginPath();
            ctx.moveTo(padding, getY(0));
            despesas.forEach((valor, index) => {
                const x = padding + (index * chartWidth / (despesas.length - 1));
                ctx.lineTo(x, getY(-Math.abs(valor)));
            });
            ctx.lineTo(rect.width - padding, getY(0));
            ctx.closePath();
            ctx.fill();
            
            // Linha de saldo (azul)
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            saldos.forEach((valor, index) => {
                const x = padding + (index * chartWidth / (saldos.length - 1));
                const y = getY(valor);
                if (index === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
            
            // Pontos de saldo com valores
            ctx.fillStyle = '#667eea';
            ctx.font = '11px Arial';
            ctx.textAlign = 'center';
            saldos.forEach((valor, index) => {
                const x = padding + (index * chartWidth / (saldos.length - 1));
                const y = getY(valor);
                
                // Ponto
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, 2 * Math.PI);
                ctx.fill();
                
                // Valor acima do ponto
                ctx.fillStyle = '#333';
                const valorFormatado = new Intl.NumberFormat('pt-BR', { 
                    style: 'currency', 
                    currency: 'BRL', 
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 0
                }).format(valor);
                ctx.fillText(valorFormatado, x, y - 15);
                ctx.fillStyle = '#667eea';
            });
            
            // Labels dos meses
            ctx.fillStyle = '#666';
            ctx.font = '12px Arial';
            ctx.textAlign = 'center';
            meses.forEach((mes, index) => {
                const x = padding + (index * chartWidth / (meses.length - 1));
                ctx.fillText(mes, x, rect.height - padding + 20);
            });
            
            // Legenda
            ctx.font = '12px Arial';
            ctx.textAlign = 'left';
            const legendY = 20;
            
            // Receitas
            ctx.fillStyle = 'rgba(40, 167, 69, 0.8)';
            ctx.fillRect(rect.width - 180, legendY, 15, 15);
            ctx.fillStyle = '#333';
            ctx.fillText('Receitas', rect.width - 160, legendY + 12);
            
            // Despesas
            ctx.fillStyle = 'rgba(220, 53, 69, 0.8)';
            ctx.fillRect(rect.width - 180, legendY + 25, 15, 15);
            ctx.fillStyle = '#333';
            ctx.fillText('Despesas', rect.width - 160, legendY + 37);
            
            // Saldo
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(rect.width - 180, legendY + 57);
            ctx.lineTo(rect.width - 165, legendY + 57);
            ctx.stroke();
            ctx.fillStyle = '#333';
            ctx.fillText('Saldo', rect.width - 160, legendY + 62);
        }
        
        // Calcular dados reais do fluxo de caixa
        function calcularDadosFluxo() {
            const agora = new Date();
            const meses = [];
            const receitas = [];
            const despesas = [];
            const saldos = [];
            
            // Gerar √∫ltimos 6 meses
            for (let i = 5; i >= 0; i--) {
                const data = new Date(agora.getFullYear(), agora.getMonth() - i, 1);
                const mesNome = data.toLocaleDateString('pt-BR', { month: 'short' });
                meses.push(mesNome.charAt(0).toUpperCase() + mesNome.slice(1));
                
                const inicioMes = new Date(data.getFullYear(), data.getMonth(), 1);
                const fimMes = new Date(data.getFullYear(), data.getMonth() + 1, 0);
                
                // Filtrar lan√ßamentos do m√™s
                const lancamentosMes = dadosCache.lancamentos.filter(l => {
                    const dataLancamento = new Date(l.data);
                    return dataLancamento >= inicioMes && dataLancamento <= fimMes;
                });
                
                const receitasMes = lancamentosMes
                    .filter(l => l.tipo === 'receita')
                    .reduce((sum, l) => sum + l.valor, 0);
                    
                const despesasMes = lancamentosMes
                    .filter(l => l.tipo === 'despesa')
                    .reduce((sum, l) => sum + l.valor, 0);
                
                receitas.push(receitasMes);
                despesas.push(despesasMes);
                saldos.push(receitasMes - despesasMes);
            }
            
            // Se n√£o h√° dados reais, usar simulados
            if (receitas.every(r => r === 0) && despesas.every(d => d === 0)) {
                return {
                    meses: ['Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago'],
                    receitas: [35000, 42000, 38000, 45000, 52000, 58000],
                    despesas: [28000, 32000, 29000, 35000, 41000, 45000],
                    saldos: [7000, 10000, 9000, 10000, 11000, 13000]
                };
            }
            
            return { meses, receitas, despesas, saldos };
        }
        
        // Vari√°vel global para armazenar dados do gr√°fico
        let dadosGraficoGlobal = null;
        
        // Adicionar interatividade ao gr√°fico
        function adicionarInteratividadeGrafico() {
            const canvas = document.getElementById('fluxoCaixaChart');
            const tooltip = document.getElementById('chartTooltip');
            
            canvas.addEventListener('mousemove', function(event) {
                if (!dadosGraficoGlobal) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                const { meses, receitas, despesas, saldos } = dadosGraficoGlobal;
                const padding = 60;
                const chartWidth = rect.width - 2 * padding;
                
                // Encontrar ponto mais pr√≥ximo
                let pontoMaisProximo = -1;
                let menorDistancia = Infinity;
                
                saldos.forEach((valor, index) => {
                    const pontox = padding + (index * chartWidth / (saldos.length - 1));
                    const distancia = Math.abs(x - pontox);
                    
                    if (distancia < menorDistancia && distancia < 30) {
                        menorDistancia = distancia;
                        pontoMaisProximo = index;
                    }
                });
                
                if (pontoMaisProximo >= 0) {
                    const receita = receitas[pontoMaisProximo];
                    const despesa = despesas[pontoMaisProximo];
                    const saldo = saldos[pontoMaisProximo];
                    const mes = meses[pontoMaisProximo];
                    
                    const receitaFormatada = new Intl.NumberFormat('pt-BR', { 
                        style: 'currency', currency: 'BRL' 
                    }).format(receita);
                    const despesaFormatada = new Intl.NumberFormat('pt-BR', { 
                        style: 'currency', currency: 'BRL' 
                    }).format(despesa);
                    const saldoFormatado = new Intl.NumberFormat('pt-BR', { 
                        style: 'currency', currency: 'BRL' 
                    }).format(saldo);
                    
                    tooltip.innerHTML = `
                        <strong>${mes}</strong><br>
                        <span style="color: #28a745;">Receitas: ${receitaFormatada}</span><br>
                        <span style="color: #dc3545;">Despesas: ${despesaFormatada}</span><br>
                        <span style="color: #667eea;"><strong>Saldo: ${saldoFormatado}</strong></span>
                    `;
                    
                    tooltip.style.left = (event.clientX - rect.left + 15) + 'px';
                    tooltip.style.top = (event.clientY - rect.top - 15) + 'px';
                    tooltip.style.display = 'block';
                } else {
                    tooltip.style.display = 'none';
                }
            });
            
            canvas.addEventListener('mouseleave', function() {
                tooltip.style.display = 'none';
            });
            
            canvas.addEventListener('click', function(event) {
                if (!dadosGraficoGlobal) return;
                
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                
                const { meses, receitas, despesas, saldos } = dadosGraficoGlobal;
                const padding = 60;
                const chartWidth = rect.width - 2 * padding;
                
                // Encontrar ponto clicado
                saldos.forEach((valor, index) => {
                    const pontox = padding + (index * chartWidth / (saldos.length - 1));
                    
                    if (Math.abs(x - pontox) < 30) {
                        const mes = meses[index];
                        const receita = receitas[index];
                        const despesa = despesas[index];
                        const saldo = saldos[index];
                        
                        alert(`Detalhes de ${mes}:\n\n` +
                              `Receitas: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(receita)}\n` +
                              `Despesas: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(despesa)}\n` +
                              `Saldo: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(saldo)}`);
                    }
                });
            });
        }
        
        // Responsividade para redimensionamento
        window.addEventListener('resize', function() {
            if (document.getElementById('dashboard').classList.contains('active')) {
                setTimeout(desenharGrafico, 100);
            }
        });

        // Posicionamento inteligente dos dropdowns
        function posicionarDropdown(dropdown) {
            const menu = dropdown.querySelector('.dropdown-menu');
            const btn = dropdown.querySelector('.nav-btn');
            
            if (!menu || !btn) return;
            
            const btnRect = btn.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const menuWidth = 220;
            const menuHeight = menu.scrollHeight || 200;
            
            let left = btnRect.left;
            let top = btnRect.bottom + 8;
            
            // Ajustar se sair da tela horizontalmente
            if (left + menuWidth > viewportWidth) {
                left = btnRect.right - menuWidth;
            }
            
            // Ajustar se sair da tela verticalmente
            if (top + menuHeight > viewportHeight) {
                top = btnRect.top - menuHeight - 8;
            }
            
            menu.style.left = Math.max(10, left) + 'px';
            menu.style.top = Math.max(10, top) + 'px';
        }

        // Adicionar eventos aos dropdowns
        document.addEventListener('DOMContentLoaded', function() {
            const dropdowns = document.querySelectorAll('.nav-dropdown');
            
            dropdowns.forEach(dropdown => {
                dropdown.addEventListener('mouseenter', function() {
                    posicionarDropdown(this);
                });
            });
            
            // Reposicionar dropdowns ao redimensionar janela
            window.addEventListener('resize', function() {
                dropdowns.forEach(dropdown => {
                    if (dropdown.matches(':hover')) {
                        posicionarDropdown(dropdown);
                    }
                });
            });
        });

        // Gerar relat√≥rio DRE
        function gerarRelatorio() {
            const inicio = document.getElementById('periodo-inicio').value;
            const fim = document.getElementById('periodo-fim').value;

            if (!inicio || !fim) {
                alert('Por favor, selecione o per√≠odo para o relat√≥rio');
                return;
            }

            const lancamentosFiltrados = dadosCache.lancamentos.filter(l => {
                return l.data >= inicio && l.data <= fim;
            });

            const receitas = lancamentosFiltrados
                .filter(l => l.tipo === 'receita')
                .reduce((sum, l) => sum + l.valor, 0);
            
            const despesas = lancamentosFiltrados
                .filter(l => l.tipo === 'despesa')
                .reduce((sum, l) => sum + l.valor, 0);

            const lucroLiquido = receitas - despesas;

            const dreContent = `
                <table style="width: 100%; margin-top: 20px;">
                    <tr><td><strong>RECEITAS TOTAIS</strong></td><td style="text-align: right;"><strong>${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(receitas)}</strong></td></tr>
                    <tr><td>(-) DESPESAS TOTAIS</td><td style="text-align: right;">${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(despesas)}</td></tr>
                    <tr style="border-top: 2px solid #333;"><td><strong>LUCRO L√çQUIDO</strong></td><td style="text-align: right;"><strong>${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(lucroLiquido)}</strong></td></tr>
                </table>
            `;

            document.getElementById('dre-content').innerHTML = dreContent;
            document.getElementById('relatorio-resultado').style.display = 'block';
        }

        // ============ NOVAS FUNCIONALIDADES ============

        // Carregar Livro Di√°rio
        function carregarDiario() {
            const tbody = document.getElementById('diario-tbody');
            tbody.innerHTML = '';

            const lancamentosOrdenados = dadosCache.lancamentos
                .sort((a, b) => new Date(a.data) - new Date(b.data));

            lancamentosOrdenados.forEach(lancamento => {
                const row = document.createElement('tr');
                const dataFormatada = new Date(lancamento.data).toLocaleDateString('pt-BR');
                const valorFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(lancamento.valor);

                // L√≥gica de d√©bito e cr√©dito baseada no tipo
                let debito = '', credito = '';
                if (lancamento.tipo === 'receita') {
                    debito = valorFormatado;
                    credito = '';
                } else {
                    debito = '';
                    credito = valorFormatado;
                }

                row.innerHTML = `
                    <td>${dataFormatada}</td>
                    <td>${lancamento.descricao}</td>
                    <td>${lancamento.conta}</td>
                    <td>${debito}</td>
                    <td>${credito}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Filtrar Livro Di√°rio por per√≠odo
        function filtrarDiario() {
            const inicio = document.getElementById('diario-inicio').value;
            const fim = document.getElementById('diario-fim').value;

            if (!inicio || !fim) {
                carregarDiario();
                return;
            }

            const tbody = document.getElementById('diario-tbody');
            tbody.innerHTML = '';

            const lancamentosFiltrados = dadosCache.lancamentos
                .filter(l => l.data >= inicio && l.data <= fim)
                .sort((a, b) => new Date(a.data) - new Date(b.data));

            lancamentosFiltrados.forEach(lancamento => {
                const row = document.createElement('tr');
                const dataFormatada = new Date(lancamento.data).toLocaleDateString('pt-BR');
                const valorFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(lancamento.valor);

                let debito = '', credito = '';
                if (lancamento.tipo === 'receita') {
                    debito = valorFormatado;
                    credito = '';
                } else {
                    debito = '';
                    credito = valorFormatado;
                }

                row.innerHTML = `
                    <td>${dataFormatada}</td>
                    <td>${lancamento.descricao}</td>
                    <td>${lancamento.conta}</td>
                    <td>${debito}</td>
                    <td>${credito}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Carregar Livro Raz√£o
        function carregarRazao() {
            filtrarRazao();
        }

        function filtrarRazao() {
            const contaFiltro = document.getElementById('conta-filtro').value;
            const tbody = document.getElementById('razao-tbody');
            tbody.innerHTML = '';

            const contas = contaFiltro ? [contaFiltro] : ['caixa', 'banco', 'vendas', 'fornecedores', 'despesas-operacionais'];

            contas.forEach(conta => {
                const movimentacoes = dadosCache.lancamentos
                    .filter(l => l.conta === conta)
                    .sort((a, b) => new Date(a.data) - new Date(b.data));

                let saldoAcumulado = 0;

                movimentacoes.forEach(mov => {
                    const row = document.createElement('tr');
                    const dataFormatada = new Date(mov.data).toLocaleDateString('pt-BR');
                    const valorFormatado = new Intl.NumberFormat('pt-BR', {
                        style: 'currency',
                        currency: 'BRL'
                    }).format(mov.valor);

                    let debito = '', credito = '';
                    if (mov.tipo === 'receita') {
                        debito = valorFormatado;
                        saldoAcumulado += mov.valor;
                    } else {
                        credito = valorFormatado;
                        saldoAcumulado -= mov.valor;
                    }

                    const saldoFormatado = new Intl.NumberFormat('pt-BR', {
                        style: 'currency',
                        currency: 'BRL'
                    }).format(saldoAcumulado);

                    row.innerHTML = `
                        <td>${dataFormatada}</td>
                        <td>${mov.descricao}</td>
                        <td>${debito}</td>
                        <td>${credito}</td>
                        <td>${saldoFormatado}</td>
                    `;
                    tbody.appendChild(row);
                });
            });
        }

        // Gerar Balan√ßo Patrimonial
        function gerarBalanco() {
            const dataRef = document.getElementById('balanco-data').value;
            if (!dataRef) {
                alert('Por favor, selecione a data de refer√™ncia');
                return;
            }

            // Calcular saldos das contas at√© a data de refer√™ncia
            const contasAtivo = dadosCache.contas.filter(c => c.tipo.includes('Ativo'));
            const contasPassivo = dadosCache.contas.filter(c => c.tipo.includes('Passivo'));
            const contasPL = dadosCache.contas.filter(c => c.tipo.includes('Patrim√¥nio'));

            let ativoContent = '<table style="width: 100%;">';
            let totalAtivo = 0;

            contasAtivo.forEach(conta => {
                const saldoFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(conta.saldo);
                
                ativoContent += `<tr><td>${conta.nome}</td><td style="text-align: right;">${saldoFormatado}</td></tr>`;
                totalAtivo += conta.saldo;
            });

            const totalAtivoFormatado = new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(totalAtivo);

            ativoContent += `<tr style="border-top: 2px solid #333; font-weight: bold;"><td>TOTAL ATIVO</td><td style="text-align: right;">${totalAtivoFormatado}</td></tr>`;
            ativoContent += '</table>';

            let passivoContent = '<table style="width: 100%;">';
            let totalPassivo = 0;

            contasPassivo.forEach(conta => {
                const saldoFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(conta.saldo);
                
                passivoContent += `<tr><td>${conta.nome}</td><td style="text-align: right;">${saldoFormatado}</td></tr>`;
                totalPassivo += conta.saldo;
            });

            contasPL.forEach(conta => {
                const saldoFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(conta.saldo);
                
                passivoContent += `<tr><td>${conta.nome}</td><td style="text-align: right;">${saldoFormatado}</td></tr>`;
                totalPassivo += conta.saldo;
            });

            const totalPassivoFormatado = new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(totalPassivo);

            passivoContent += `<tr style="border-top: 2px solid #333; font-weight: bold;"><td>TOTAL PASSIVO + PL</td><td style="text-align: right;">${totalPassivoFormatado}</td></tr>`;
            passivoContent += '</table>';

            document.getElementById('ativo-content').innerHTML = ativoContent;
            document.getElementById('passivo-content').innerHTML = passivoContent;
            document.getElementById('totais-balanco').innerHTML = `
                <div style="text-align: center; font-weight: bold; font-size: 1.1rem;">
                    Total Ativo: ${totalAtivoFormatado} | Total Passivo + PL: ${totalPassivoFormatado}
                </div>
            `;
            
            document.getElementById('balanco-resultado').style.display = 'block';
        }

        // Carregar Contas a Pagar/Receber
        function carregarContasReceber() {
            const tbody = document.getElementById('contas-receber-tbody');
            tbody.innerHTML = '';

            if (!dadosCache.contasPagarReceber) {
                dadosCache.contasPagarReceber = [];
                return;
            }

            let totalReceber = 0;
            let totalPagar = 0;
            let totalVencidas = 0;
            const hoje = new Date();

            dadosCache.contasPagarReceber.forEach(conta => {
                const row = document.createElement('tr');
                const vencimentoFormatado = new Date(conta.vencimento).toLocaleDateString('pt-BR');
                const valorFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(conta.valor);

                // Verificar se est√° vencida
                const dataVencimento = new Date(conta.vencimento);
                const isVencida = dataVencimento < hoje && conta.status === 'pendente';
                
                if (isVencida) {
                    conta.status = 'vencida';
                    totalVencidas++;
                }

                if (conta.tipo === 'receber') {
                    totalReceber += conta.valor;
                } else {
                    totalPagar += conta.valor;
                }

                let statusClass = 'status ';
                if (conta.status === 'vencida') statusClass += 'despesa';
                else if (conta.status === 'pago') statusClass += 'receita';
                else statusClass += 'pago';

                row.innerHTML = `
                    <td><span class="status ${conta.tipo}">${conta.tipo}</span></td>
                    <td>${vencimentoFormatado}</td>
                    <td>${conta.cliente}</td>
                    <td>${conta.descricao}</td>
                    <td>${valorFormatado}</td>
                    <td><span class="${statusClass}">${conta.status}</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="excluirContaReceber(${conta.id})" style="padding: 8px 16px; font-size: 0.9rem;">
                            Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // Atualizar totais
            document.getElementById('total-receber').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalReceber);
            document.getElementById('total-pagar').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalPagar);
            document.getElementById('total-vencidas').textContent = totalVencidas;
        }

        // Adicionar nova conta a pagar/receber
        document.getElementById('conta-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const novaConta = {
                id: Date.now(),
                tipo: document.getElementById('conta-tipo').value,
                vencimento: document.getElementById('conta-vencimento').value,
                cliente: document.getElementById('conta-cliente').value,
                descricao: document.getElementById('conta-descricao').value,
                valor: parseFloat(document.getElementById('conta-valor').value),
                status: 'pendente'
            };

            dadosCache.contasPagarReceber.push(novaConta);
            
            // Registrar log de auditoria
            registrarLog('CONTA_CRIADA', `Nova conta ${novaConta.tipo}: ${novaConta.cliente} - R$ ${novaConta.valor}`);
            
            // Salvar no localStorage
            salvarDadosLocalStorage();
            
            // Limpar formul√°rio
            this.reset();
            
            // Recarregar tabela
            carregarContasReceber();

            alert('Conta adicionada com sucesso!');
        });

        // Excluir conta a pagar/receber
        function excluirContaReceber(id) {
            if (confirm('Tem certeza que deseja excluir esta conta?')) {
                if (!dadosCache.contasPagarReceber) {
                    dadosCache.contasPagarReceber = [];
                    return;
                }
                
                const contaExcluida = dadosCache.contasPagarReceber.find(c => c.id === id);
                dadosCache.contasPagarReceber = dadosCache.contasPagarReceber.filter(c => c.id !== id);
                
                // Registrar log de auditoria
                if (contaExcluida) {
                    registrarLog('CONTA_EXCLUIDA', `Conta exclu√≠da: ${contaExcluida.tipo} - ${contaExcluida.cliente} - R$ ${contaExcluida.valor}`);
                }
                
                salvarDadosLocalStorage();
                carregarContasReceber();
                alert('Conta exclu√≠da com sucesso!');
            }
        }

        // ============ M√ìDULO FISCAL ============

        // Carregar M√≥dulo Fiscal
        function carregarModuloFiscal() {
            carregarImpostos();
            atualizarDashboardFiscal();
        }

        function carregarImpostos() {
            const tbody = document.getElementById('impostos-tbody');
            tbody.innerHTML = '';

            if (!dadosCache.impostos) {
                dadosCache.impostos = [];
                return;
            }

            dadosCache.impostos.forEach(imposto => {
                const row = document.createElement('tr');
                const periodoFormatado = new Date(imposto.periodo + '-01').toLocaleDateString('pt-BR', { year: 'numeric', month: 'long' });
                const baseFormatada = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(imposto.baseCalculo);
                const valorFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(imposto.valor);

                row.innerHTML = `
                    <td><span class="status receita">${imposto.tipo.toUpperCase()}</span></td>
                    <td>${periodoFormatado}</td>
                    <td>${baseFormatada}</td>
                    <td>${imposto.aliquota}%</td>
                    <td>${valorFormatado}</td>
                    <td><span class="status pago">${imposto.status}</span></td>
                    <td>
                        <button class="btn btn-danger" onclick="excluirImposto(${imposto.id})" style="padding: 8px 16px; font-size: 0.9rem;">
                            Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function atualizarDashboardFiscal() {
            if (!dadosCache.impostos) {
                dadosCache.impostos = [];
            }
            
            const icms = dadosCache.impostos.filter(i => i.tipo === 'icms').reduce((sum, i) => sum + i.valor, 0);
            const pisCofins = dadosCache.impostos.filter(i => ['pis', 'cofins'].includes(i.tipo)).reduce((sum, i) => sum + i.valor, 0);

            document.getElementById('icms-recolher').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(icms);
            document.getElementById('pis-cofins').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(pisCofins);
        }

        // Adicionar novo imposto
        document.getElementById('imposto-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const baseCalculo = parseFloat(document.getElementById('imposto-base').value);
            const aliquota = parseFloat(document.getElementById('imposto-aliquota').value);
            const valor = (baseCalculo * aliquota) / 100;

            const novoImposto = {
                id: Date.now(),
                tipo: document.getElementById('imposto-tipo').value,
                periodo: document.getElementById('imposto-periodo').value,
                baseCalculo: baseCalculo,
                aliquota: aliquota,
                valor: valor,
                status: 'apurado'
            };

            dadosCache.impostos.push(novoImposto);
            
            // Registrar log de auditoria
            registrarLog('IMPOSTO_APURADO', `${novoImposto.tipo.toUpperCase()} apurado: ${novoImposto.periodo} - R$ ${novoImposto.valor.toFixed(2)}`);
            
            // Salvar no localStorage
            salvarDadosLocalStorage();
            
            // Limpar formul√°rio
            this.reset();
            
            // Recarregar tabela
            carregarImpostos();
            atualizarDashboardFiscal();

            alert('Imposto apurado com sucesso!');
        });

        // Excluir imposto
        function excluirImposto(id) {
            if (confirm('Tem certeza que deseja excluir esta apura√ß√£o?')) {
                const impostoExcluido = dadosCache.impostos.find(i => i.id === id);
                dadosCache.impostos = dadosCache.impostos.filter(i => i.id !== id);
                
                // Registrar log de auditoria
                if (impostoExcluido) {
                    registrarLog('IMPOSTO_EXCLUIDO', `Imposto exclu√≠do: ${impostoExcluido.tipo.toUpperCase()} - ${impostoExcluido.periodo}`);
                }
                
                salvarDadosLocalStorage();
                carregarImpostos();
                atualizarDashboardFiscal();
                alert('Imposto exclu√≠do com sucesso!');
            }
        }

        // Gerar SPED Fiscal
        function gerarSpedFiscal() {
            const periodo = document.getElementById('sped-periodo').value;
            if (!periodo) {
                alert('Selecione o per√≠odo para gerar o SPED');
                return;
            }

            if (!dadosCache.impostos) {
                dadosCache.impostos = [];
            }
            
            const impostosPeriodo = dadosCache.impostos.filter(i => i.periodo === periodo);
            
            if (impostosPeriodo.length === 0) {
                alert('N√£o h√° apura√ß√µes para o per√≠odo selecionado');
                return;
            }

            let spedContent = `
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; font-family: monospace;">
                    <strong>ARQUIVO SPED FISCAL - PER√çODO: ${periodo}</strong><br><br>
                    |0000|014|0|${new Date().toISOString().split('T')[0].replace(/-/g, '')}|${new Date().toISOString().split('T')[0].replace(/-/g, '')}|EMPRESA EXEMPLO LTDA|12345678000199|SP|123456789|1|0|<br>
                    |0001|0|<br>
                    |0005|SISTEMA CONTABILIDADE POC|1.0.0|<br>
            `;

            impostosPeriodo.forEach(imposto => {
                spedContent += `|C100|0|1|${imposto.tipo.toUpperCase()}|${periodo.replace('-', '')}01|${imposto.baseCalculo.toFixed(2).replace('.', ',')}|${imposto.valor.toFixed(2).replace('.', ',')}|<br>`;
            });

            spedContent += `
                    |9999|${impostosPeriodo.length + 4}|<br><br>
                    <em>Arquivo gerado em: ${new Date().toLocaleString('pt-BR')}</em>
                </div>
            `;

            document.getElementById('sped-content').innerHTML = spedContent;
            document.getElementById('sped-resultado').style.display = 'block';
            document.getElementById('sped-status').textContent = 'Gerado';

            // Atualizar informa√ß√µes do dashboard SPED
            document.getElementById('sped-status-card').textContent = 'Gerado';
            document.getElementById('ultimo-periodo').textContent = periodo;
            document.getElementById('total-registros').textContent = impostosPeriodo.length + 4;
            document.getElementById('sped-data-geracao').textContent = `Gerado em: ${new Date().toLocaleString('pt-BR')}`;
            document.getElementById('sped-periodo-exibido').textContent = periodo;
            document.getElementById('sped-total-registros').textContent = impostosPeriodo.length + 4;

            // Adicionar ao hist√≥rico
            adicionarHistoricoSped(periodo, impostosPeriodo.length + 4);

            // Registrar log
            registrarLog('SPED_GERADO', `SPED Fiscal gerado para per√≠odo ${periodo}`);
        }

        // ============ NOVA SE√á√ÉO SPED FISCAL ============

        // Carregar se√ß√£o SPED Fiscal
        function carregarSpedFiscal() {
            carregarHistoricoSped();
            atualizarDashboardSped();
        }

        // Atualizar dashboard do SPED
        function atualizarDashboardSped() {
            // Valores podem ser atualizados dinamicamente
        }

        // Validar SPED Fiscal
        function validarSpedFiscal() {
            const spedResultado = document.getElementById('sped-resultado');
            if (spedResultado.style.display === 'none') {
                alert('Primeiro gere um arquivo SPED para validar');
                return;
            }

            // Simula√ß√£o de valida√ß√£o
            setTimeout(() => {
                document.getElementById('sped-status-validacao').textContent = 'Validado';
                document.getElementById('sped-status-validacao').className = 'status receita';
                alert('SPED Fiscal validado com sucesso!\n\n‚úÖ Estrutura correta\n‚úÖ Registros consistentes\n‚úÖ Pronto para transmiss√£o');
            }, 1000);
        }

        // Exportar SPED Fiscal
        function exportarSpedFiscal() {
            const spedResultado = document.getElementById('sped-resultado');
            if (spedResultado.style.display === 'none') {
                alert('Primeiro gere um arquivo SPED para exportar');
                return;
            }

            const periodo = document.getElementById('sped-periodo').value;
            const conteudo = document.getElementById('sped-content').textContent;
            
            // Criar um blob com o conte√∫do do SPED
            const blob = new Blob([conteudo], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SPED_FISCAL_${periodo.replace('-', '')}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);

            registrarLog('SPED_EXPORTADO', `SPED Fiscal exportado: ${periodo}`);
            alert('Arquivo SPED exportado com sucesso!');
        }

        // Adicionar ao hist√≥rico de SPED
        function adicionarHistoricoSped(periodo, registros) {
            if (!dadosCache.historicoSped) {
                dadosCache.historicoSped = [];
            }

            const novoHistorico = {
                id: Date.now(),
                periodo: periodo,
                dataGeracao: new Date().toISOString(),
                registros: registros,
                status: 'Gerado'
            };

            dadosCache.historicoSped.unshift(novoHistorico);
            salvarDadosLocalStorage();
            carregarHistoricoSped();
        }

        // Carregar hist√≥rico de SPED
        function carregarHistoricoSped() {
            const tbody = document.getElementById('historico-sped-tbody');
            tbody.innerHTML = '';

            if (!dadosCache.historicoSped) {
                dadosCache.historicoSped = [];
                return;
            }

            dadosCache.historicoSped.forEach(sped => {
                const row = document.createElement('tr');
                const dataFormatada = new Date(sped.dataGeracao).toLocaleString('pt-BR');

                row.innerHTML = `
                    <td>${sped.periodo}</td>
                    <td>${dataFormatada}</td>
                    <td>${sped.registros}</td>
                    <td><span class="status pago">${sped.status}</span></td>
                    <td>
                        <button class="btn" onclick="regerarSped('${sped.periodo}')" style="padding: 8px 16px; font-size: 0.8rem;">
                            üîÑ Regerar
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Regerar SPED
        function regerarSped(periodo) {
            document.getElementById('sped-periodo').value = periodo;
            gerarSpedFiscal();
        }

        // ============ FOLHA DE PAGAMENTO ============

        // Carregar Folha de Pagamento
        function carregarFolhaPagamento() {
            carregarFuncionarios();
            atualizarDashboardFolha();
        }

        function carregarFuncionarios() {
            const tbody = document.getElementById('funcionarios-tbody');
            tbody.innerHTML = '';

            if (!dadosCache.funcionarios) {
                dadosCache.funcionarios = [];
                return;
            }

            dadosCache.funcionarios.filter(f => f.ativo).forEach(funcionario => {
                const row = document.createElement('tr');
                const admissaoFormatada = new Date(funcionario.dataAdmissao).toLocaleDateString('pt-BR');
                const salarioBrutoFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(funcionario.salarioBruto);
                
                // Calcular sal√°rio l√≠quido (aproximado)
                const inss = Math.min(funcionario.salarioBruto * 0.11, 877.24); // Teto INSS 2024
                const irrf = funcionario.salarioBruto > 2259.20 ? (funcionario.salarioBruto - 2259.20) * 0.075 : 0;
                const salarioLiquido = funcionario.salarioBruto - inss - irrf;
                
                const salarioLiquidoFormatado = new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                }).format(salarioLiquido);

                row.innerHTML = `
                    <td>${funcionario.nome}</td>
                    <td>${funcionario.cpf}</td>
                    <td>${funcionario.cargo}</td>
                    <td><span class="status receita">${funcionario.departamento}</span></td>
                    <td>${salarioBrutoFormatado}</td>
                    <td>${salarioLiquidoFormatado}</td>
                    <td>${admissaoFormatada}</td>
                    <td>
                        <button class="btn btn-danger" onclick="excluirFuncionario(${funcionario.id})" style="padding: 8px 16px; font-size: 0.9rem;">
                            Desligar
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function atualizarDashboardFolha() {
            if (!dadosCache.funcionarios) {
                dadosCache.funcionarios = [];
            }
            
            const funcionariosAtivos = dadosCache.funcionarios.filter(f => f.ativo);
            const folhaBruta = funcionariosAtivos.reduce((sum, f) => sum + f.salarioBruto, 0);
            const encargos = folhaBruta * 0.36; // Encargos aproximados (36%)
            const folhaLiquida = folhaBruta * 0.75; // L√≠quida aproximada (75%)

            document.getElementById('total-funcionarios').textContent = funcionariosAtivos.length;
            document.getElementById('folha-bruta').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(folhaBruta);
            document.getElementById('total-encargos').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(encargos);
            document.getElementById('folha-liquida').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(folhaLiquida);
        }

        // Adicionar novo funcion√°rio
        document.getElementById('funcionario-form').addEventListener('submit', function(e) {
            e.preventDefault();

            const novoFuncionario = {
                id: Date.now(),
                nome: document.getElementById('func-nome').value,
                cpf: document.getElementById('func-cpf').value,
                cargo: document.getElementById('func-cargo').value,
                departamento: document.getElementById('func-departamento').value,
                salarioBruto: parseFloat(document.getElementById('func-salario').value),
                dataAdmissao: document.getElementById('func-admissao').value,
                ativo: true
            };

            dadosCache.funcionarios.push(novoFuncionario);
            
            // Registrar log de auditoria
            registrarLog('FUNCIONARIO_CADASTRADO', `Novo funcion√°rio: ${novoFuncionario.nome} - ${novoFuncionario.cargo}`);
            
            // Salvar no localStorage
            salvarDadosLocalStorage();
            
            // Limpar formul√°rio
            this.reset();
            
            // Recarregar tabela
            carregarFuncionarios();
            atualizarDashboardFolha();

            alert('Funcion√°rio cadastrado com sucesso!');
        });

        // Desligar funcion√°rio
        function excluirFuncionario(id) {
            if (confirm('Tem certeza que deseja desligar este funcion√°rio?')) {
                if (!dadosCache.funcionarios) {
                    dadosCache.funcionarios = [];
                    return;
                }
                
                const funcionario = dadosCache.funcionarios.find(f => f.id === id);
                if (funcionario) {
                    funcionario.ativo = false;
                    
                    // Registrar log de auditoria
                    registrarLog('FUNCIONARIO_DESLIGADO', `Funcion√°rio desligado: ${funcionario.nome}`);
                }
                
                salvarDadosLocalStorage();
                carregarFuncionarios();
                atualizarDashboardFolha();
                alert('Funcion√°rio desligado com sucesso!');
            }
        }

        // Processar Folha de Pagamento
        function processarFolha() {
            const periodo = document.getElementById('folha-periodo').value;
            if (!periodo) {
                alert('Selecione o per√≠odo para processar a folha');
                return;
            }

            if (!dadosCache.funcionarios) {
                dadosCache.funcionarios = [];
            }
            
            const funcionariosAtivos = dadosCache.funcionarios.filter(f => f.ativo);
            
            if (funcionariosAtivos.length === 0) {
                alert('N√£o h√° funcion√°rios ativos para processar');
                return;
            }

            let resumoContent = `
                <table style="width: 100%; margin-top: 20px;">
                    <tr><th colspan="2" style="text-align: center; background: #667eea; color: white;">RESUMO DA FOLHA - ${periodo}</th></tr>
            `;

            let totalBruto = 0;
            let totalLiquido = 0;
            let totalEncargos = 0;

            funcionariosAtivos.forEach(func => {
                const inss = Math.min(func.salarioBruto * 0.11, 877.24);
                const irrf = func.salarioBruto > 2259.20 ? (func.salarioBruto - 2259.20) * 0.075 : 0;
                const liquido = func.salarioBruto - inss - irrf;
                const encargos = func.salarioBruto * 0.36;

                totalBruto += func.salarioBruto;
                totalLiquido += liquido;
                totalEncargos += encargos;

                resumoContent += `
                    <tr>
                        <td>${func.nome}</td>
                        <td style="text-align: right;">${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(liquido)}</td>
                    </tr>
                `;
            });

            resumoContent += `
                    <tr style="border-top: 2px solid #333; font-weight: bold;">
                        <td>TOTAL FOLHA BRUTA</td>
                        <td style="text-align: right;">${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalBruto)}</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td>TOTAL FOLHA L√çQUIDA</td>
                        <td style="text-align: right;">${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalLiquido)}</td>
                    </tr>
                    <tr style="font-weight: bold;">
                        <td>TOTAL ENCARGOS</td>
                        <td style="text-align: right;">${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalEncargos)}</td>
                    </tr>
                </table>
            `;

            document.getElementById('folha-resumo').innerHTML = resumoContent;
            document.getElementById('folha-resultado').style.display = 'block';

            // Registrar log
            registrarLog('FOLHA_PROCESSADA', `Folha processada para ${periodo} - ${funcionariosAtivos.length} funcion√°rios`);

            alert('Folha de pagamento processada com sucesso!');
        }

        // ============ FUN√á√ïES E-SOCIAL ============

        // Alternar entre abas do e-Social
        function showEsocialTab(tabName) {
            // Remover classe active de todas as abas e bot√µes
            document.querySelectorAll('.esocial-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Adicionar classe active na aba e bot√£o selecionados
            document.getElementById(`esocial-${tabName}`).classList.add('active');
            event.target.classList.add('active');

            // Carregar dados espec√≠ficos da aba
            if (tabName === 'eventos') {
                carregarEventosESocial();
            } else if (tabName === 'trabalhadores') {
                carregarTrabalhadoresESocial();
            } else if (tabName === 'remuneracao') {
                carregarRemuneracaoESocial();
            } else if (tabName === 'transmissao') {
                carregarTransmissaoESocial();
            }
        }

        // Carregar dados principais do e-Social
        function carregarESocial() {
            atualizarDashboardESocial();
            carregarEventosESocial();
        }

        // Atualizar dashboard do e-Social
        function atualizarDashboardESocial() {
            // Verificar se os dados existem
            if (!dadosCache || !dadosCache.eventosESocial || !Array.isArray(dadosCache.eventosESocial)) {
                console.warn('Dados do e-Social n√£o encontrados, inicializando...');
                if (!dadosCache.eventosESocial) {
                    dadosCache.eventosESocial = [];
                }
                return;
            }

            const eventos = dadosCache.eventosESocial;
            
            const enviados = eventos.filter(e => e.status === 'processado').length;
            const pendentes = eventos.filter(e => e.status === 'pendente').length;
            const erros = eventos.filter(e => e.status === 'erro').length;
            const processados = enviados;

            // Verificar se os elementos existem antes de atualizar
            const elementoEnviados = document.getElementById('esocial-enviados');
            const elementoPendentes = document.getElementById('esocial-pendentes');
            const elementoErros = document.getElementById('esocial-erros');
            const elementoProcessados = document.getElementById('esocial-processados');

            if (elementoEnviados) elementoEnviados.textContent = enviados;
            if (elementoPendentes) elementoPendentes.textContent = pendentes;
            if (elementoErros) elementoErros.textContent = erros;
            if (elementoProcessados) elementoProcessados.textContent = processados;
        }

        // Carregar lista de eventos e-Social
        function carregarEventosESocial() {
            const tbody = document.getElementById('eventos-esocial-tbody');
            if (!tbody) return;

            // Verificar se os dados existem
            if (!dadosCache || !dadosCache.eventosESocial || !Array.isArray(dadosCache.eventosESocial)) {
                tbody.innerHTML = '<tr><td colspan="7">Nenhum evento encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = '';

            dadosCache.eventosESocial.forEach(evento => {
                const row = document.createElement('tr');
                
                const statusClass = evento.status === 'processado' ? 'success' : 
                                   evento.status === 'erro' ? 'error' : 'warning';
                
                const statusText = evento.status === 'processado' ? '‚úÖ Processado' :
                                  evento.status === 'erro' ? '‚ùå Erro' : '‚è≥ Pendente';

                row.innerHTML = `
                    <td>${evento.tipo}</td>
                    <td>${evento.funcionarioNome}</td>
                    <td>${evento.periodo}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>${evento.protocolo || '-'}</td>
                    <td>${new Date(evento.dataCriacao).toLocaleString('pt-BR')}</td>
                    <td>
                        <button class="btn-action" onclick="visualizarEvento(${evento.id})">üëÅÔ∏è</button>
                        <button class="btn-action" onclick="reenviarEvento(${evento.id})" ${evento.status === 'processado' ? 'disabled' : ''}>üîÑ</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Carregar lista de trabalhadores para e-Social
        function carregarTrabalhadoresESocial() {
            const tbody = document.getElementById('trabalhadores-esocial-tbody');
            if (!tbody) return;

            // Verificar se os dados existem
            if (!dadosCache || !dadosCache.funcionarios || !Array.isArray(dadosCache.funcionarios)) {
                tbody.innerHTML = '<tr><td colspan="6">Nenhum funcion√°rio encontrado</td></tr>';
                return;
            }

            tbody.innerHTML = '';

            dadosCache.funcionarios.forEach(func => {
                const row = document.createElement('tr');
                
                // Status baseado em eventos existentes
                const eventosFunc = (dadosCache.eventosESocial || []).filter(e => e.funcionarioId === func.id);
                const temS2200 = eventosFunc.some(e => e.tipo === 'S-2200');
                const status = temS2200 ? '‚úÖ Cadastrado' : '‚ö†Ô∏è Pendente';

                row.innerHTML = `
                    <td>${func.nome}</td>
                    <td>${func.cpf}</td>
                    <td>${func.cargo}</td>
                    <td>${new Date(func.dataAdmissao).toLocaleDateString('pt-BR')}</td>
                    <td><span class="status ${temS2200 ? 'success' : 'warning'}">${status}</span></td>
                    <td>
                        <button class="btn-action" onclick="gerarS2200(${func.id})" ${temS2200 ? 'disabled' : ''}>üìù S-2200</button>
                        <button class="btn-action" onclick="editarTrabalhadorESocial(${func.id})">‚úèÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Carregar dados de remunera√ß√£o e-Social
        function carregarRemuneracaoESocial() {
            const tbody = document.getElementById('remuneracao-esocial-tbody');
            if (!tbody) return;

            // Verificar se os dados existem
            if (!dadosCache || !dadosCache.remuneracaoESocial || !Array.isArray(dadosCache.remuneracaoESocial)) {
                tbody.innerHTML = '<tr><td colspan="7">Nenhuma remunera√ß√£o encontrada</td></tr>';
                return;
            }

            tbody.innerHTML = '';

            dadosCache.remuneracaoESocial.forEach(rem => {
                const row = document.createElement('tr');
                
                const statusClass = rem.statusS1200 === 'enviado' ? 'success' : 
                                   rem.statusS1200 === 'erro' ? 'error' : 'warning';
                
                const statusText = rem.statusS1200 === 'enviado' ? '‚úÖ Enviado' :
                                  rem.statusS1200 === 'erro' ? '‚ùå Erro' : '‚è≥ Pendente';

                row.innerHTML = `
                    <td>${rem.funcionarioNome}</td>
                    <td>${rem.periodo}</td>
                    <td>${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(rem.salarioBase)}</td>
                    <td>${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(rem.proventos)}</td>
                    <td>${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(rem.descontos)}</td>
                    <td><span class="status ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn-action" onclick="gerarS1200(${rem.funcionarioId}, '${rem.periodo}')">üì§ S-1200</button>
                        <button class="btn-action" onclick="visualizarRemuneracao(${rem.id})">üëÅÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Carregar dados de transmiss√£o
        function carregarTransmissaoESocial() {
            atualizarDashboardTransmissao();
        }

        // Atualizar dashboard de transmiss√£o
        function atualizarDashboardTransmissao() {
            const eventos = dadosCache.eventosESocial;
            const hoje = new Date().toISOString().split('T')[0];
            
            // Calcular m√©tricas
            const filaTransmissao = eventos.filter(e => e.status === 'pendente').length;
            const processadosHoje = eventos.filter(e => 
                e.status === 'processado' && 
                new Date(e.dataCriacao).toISOString().split('T')[0] === hoje
            ).length;
            
            // Atualizar elementos
            if (document.getElementById('fila-transmissao')) {
                document.getElementById('fila-transmissao').textContent = filaTransmissao;
            }
            if (document.getElementById('processados-hoje')) {
                document.getElementById('processados-hoje').textContent = processadosHoje;
            }
        }

        // Fun√ß√µes auxiliares para formul√°rios
        function mostrarFormularioEvento() {
            const tipoEvento = document.getElementById('evento-tipo').value;
            
            // Ocultar todos os formul√°rios
            document.querySelectorAll('.evento-form').forEach(form => {
                form.style.display = 'none';
            });
            
            // Mostrar formul√°rio correspondente
            if (tipoEvento) {
                const formId = `form-${tipoEvento.toLowerCase()}`;
                const form = document.getElementById(formId);
                if (form) {
                    form.style.display = 'block';
                    carregarOpcoesFuncionarios(tipoEvento);
                }
            }
        }

        function carregarOpcoesFuncionarios(tipoEvento) {
            const funcionariosAtivos = dadosCache.funcionarios.filter(f => f.ativo);
            const selectId = `${tipoEvento.toLowerCase()}-funcionario`;
            const select = document.getElementById(selectId);
            
            if (select) {
                select.innerHTML = '<option value="">Selecione o funcion√°rio...</option>';
                funcionariosAtivos.forEach(func => {
                    const option = document.createElement('option');
                    option.value = func.id;
                    option.textContent = func.nome;
                    select.appendChild(option);
                });
            }
        }

        function gerarEventoS1200() {
            const funcionarioId = parseInt(document.getElementById('s1200-funcionario').value);
            const periodo = document.getElementById('evento-periodo').value;
            
            if (!funcionarioId || !periodo) {
                alert('Selecione o funcion√°rio e o per√≠odo!');
                return;
            }
            
            gerarS1200(funcionarioId, periodo);
        }

        function gerarEventoS2200() {
            const funcionarioId = parseInt(document.getElementById('s2200-funcionario').value);
            
            if (!funcionarioId) {
                alert('Selecione o funcion√°rio!');
                return;
            }
            
            gerarS2200(funcionarioId);
        }

        function visualizarRemuneracao(remuneracaoId) {
            const remuneracao = dadosCache.remuneracaoESocial.find(r => r.id === remuneracaoId);
            if (!remuneracao) {
                alert('Remunera√ß√£o n√£o encontrada!');
                return;
            }

            const liquido = remuneracao.proventos - remuneracao.descontos;
            const detalhes = `
DETALHES DA REMUNERA√á√ÉO
==========================================
Funcion√°rio: ${remuneracao.funcionarioNome}
Per√≠odo: ${remuneracao.periodo}

üí∞ VALORES:
Sal√°rio Base: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(remuneracao.salarioBase)}
Proventos: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(remuneracao.proventos)}
Descontos: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(remuneracao.descontos)}
L√≠quido: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(liquido)}

üìã STATUS:
S-1200: ${remuneracao.statusS1200}
            `;

            alert(detalhes);
        }

        function editarTrabalhadorESocial(funcionarioId) {
            // Placeholder para edi√ß√£o de trabalhador
            alert('Funcionalidade de edi√ß√£o em desenvolvimento!\nEm breve ser√° poss√≠vel editar os dados do trabalhador diretamente na interface e-Social.');
        }

        // Gerar evento S-1200 (Remunera√ß√£o)
        function gerarS1200(funcionarioId, periodo) {
            const funcionario = dadosCache.funcionarios.find(f => f.id === funcionarioId);
            if (!funcionario) {
                alert('Funcion√°rio n√£o encontrado!');
                return;
            }

            // Simular gera√ß√£o do evento S-1200
            const novoEvento = {
                id: dadosCache.eventosESocial.length + 1,
                tipo: 'S-1200',
                funcionarioId: funcionarioId,
                funcionarioNome: funcionario.nome,
                periodo: periodo || '2024-08',
                status: 'pendente',
                dataCriacao: new Date().toISOString(),
                protocolo: null
            };

            dadosCache.eventosESocial.push(novoEvento);
            
            // Atualizar exibi√ß√µes
            carregarEventosESocial();
            atualizarDashboardESocial();
            
            alert(`Evento S-1200 gerado para ${funcionario.nome}!`);
        }

        // Gerar evento S-2200 (Admiss√£o)
        function gerarS2200(funcionarioId) {
            const funcionario = dadosCache.funcionarios.find(f => f.id === funcionarioId);
            if (!funcionario) {
                alert('Funcion√°rio n√£o encontrado!');
                return;
            }

            // Verificar se j√° existe S-2200 para este funcion√°rio
            const jaExiste = dadosCache.eventosESocial.some(e => 
                e.tipo === 'S-2200' && e.funcionarioId === funcionarioId
            );

            if (jaExiste) {
                alert('Evento S-2200 j√° existe para este funcion√°rio!');
                return;
            }

            // Simular gera√ß√£o do evento S-2200
            const novoEvento = {
                id: dadosCache.eventosESocial.length + 1,
                tipo: 'S-2200',
                funcionarioId: funcionarioId,
                funcionarioNome: funcionario.nome,
                periodo: new Date(funcionario.dataAdmissao).toISOString().slice(0, 7),
                status: 'pendente',
                dataCriacao: new Date().toISOString(),
                protocolo: null
            };

            dadosCache.eventosESocial.push(novoEvento);
            
            // Atualizar exibi√ß√µes
            carregarEventosESocial();
            carregarTrabalhadoresESocial();
            atualizarDashboardESocial();
            
            alert(`Evento S-2200 (Admiss√£o) gerado para ${funcionario.nome}!`);
        }

        // Visualizar detalhes de um evento
        function visualizarEvento(eventoId) {
            const evento = dadosCache.eventosESocial.find(e => e.id === eventoId);
            if (!evento) {
                alert('Evento n√£o encontrado!');
                return;
            }

            const detalhes = `
                Tipo: ${evento.tipo}
                Funcion√°rio: ${evento.funcionarioNome}
                Per√≠odo: ${evento.periodo}
                Status: ${evento.status}
                Protocolo: ${evento.protocolo || 'N√£o processado'}
                Data: ${new Date(evento.dataCriacao).toLocaleString('pt-BR')}
            `;

            alert(detalhes);
        }

        // Reenviar evento com erro
        function reenviarEvento(eventoId) {
            const evento = dadosCache.eventosESocial.find(e => e.id === eventoId);
            if (!evento) {
                alert('Evento n√£o encontrado!');
                return;
            }

            if (evento.status === 'processado') {
                alert('Evento j√° foi processado com sucesso!');
                return;
            }

            // Simular reenvio
            evento.status = 'processado';
            evento.protocolo = `ES${Date.now()}`;
            
            carregarEventosESocial();
            atualizarDashboardESocial();
            
            alert(`Evento ${evento.tipo} reenviado com sucesso!`);
        }

        // Processar remunera√ß√£o mensal automaticamente
        function processarRemuneracaoMensal() {
            const periodo = document.getElementById('rem-periodo').value;
            if (!periodo) {
                alert('Selecione o per√≠odo!');
                return;
            }

            const funcionariosAtivos = dadosCache.funcionarios.filter(f => f.ativo);
            let eventosGerados = 0;

            funcionariosAtivos.forEach(funcionario => {
                // Verificar se j√° existe remunera√ß√£o para este funcion√°rio no per√≠odo
                const jaExiste = dadosCache.remuneracaoESocial.some(r => 
                    r.funcionarioId === funcionario.id && r.periodo === periodo
                );

                if (!jaExiste) {
                    // Calcular remunera√ß√£o
                    const salarioBase = funcionario.salarioBruto;
                    const proventos = salarioBase;
                    const inss = Math.min(salarioBase * 0.11, 713.10); // INSS m√°ximo em 2024
                    const irrf = calcularIRRF(salarioBase, inss);
                    const descontos = inss + irrf;

                    // Adicionar remunera√ß√£o
                    const novaRemuneracao = {
                        id: dadosCache.remuneracaoESocial.length + 1,
                        funcionarioId: funcionario.id,
                        funcionarioNome: funcionario.nome,
                        periodo: periodo,
                        salarioBase: salarioBase,
                        proventos: proventos,
                        descontos: descontos,
                        statusS1200: 'pendente'
                    };

                    dadosCache.remuneracaoESocial.push(novaRemuneracao);

                    // Gerar evento S-1200 automaticamente
                    const novoEvento = {
                        id: dadosCache.eventosESocial.length + 1,
                        tipo: 'S-1200',
                        funcionarioId: funcionario.id,
                        funcionarioNome: funcionario.nome,
                        periodo: periodo,
                        status: 'pendente',
                        dataCriacao: new Date().toISOString(),
                        protocolo: null,
                        dados: {
                            salarioBase: salarioBase,
                            proventos: proventos,
                            descontos: descontos,
                            inss: inss,
                            irrf: irrf
                        }
                    };

                    dadosCache.eventosESocial.push(novoEvento);
                    eventosGerados++;
                }
            });

            // Atualizar exibi√ß√µes
            carregarRemuneracaoESocial();
            carregarEventosESocial();
            atualizarDashboardESocial();

            alert(`Remunera√ß√£o mensal processada!\n${eventosGerados} eventos S-1200 gerados para o per√≠odo ${periodo}.`);
        }

        // Calcular IRRF
        function calcularIRRF(salarioBruto, inss) {
            const baseCalculo = salarioBruto - inss - 189.59; // Dedu√ß√£o por dependente padr√£o
            
            if (baseCalculo <= 1903.98) return 0;
            if (baseCalculo <= 2826.65) return (baseCalculo * 0.075) - 142.80;
            if (baseCalculo <= 3751.05) return (baseCalculo * 0.15) - 354.80;
            if (baseCalculo <= 4664.68) return (baseCalculo * 0.225) - 636.13;
            return (baseCalculo * 0.275) - 869.36;
        }

        // Transmitir eventos pendentes
        function transmitirEventos() {
            const eventosPendentes = dadosCache.eventosESocial.filter(e => e.status === 'pendente');
            
            if (eventosPendentes.length === 0) {
                alert('N√£o h√° eventos pendentes para transmiss√£o!');
                return;
            }

            // Simular transmiss√£o
            let sucessos = 0;
            let erros = 0;

            eventosPendentes.forEach(evento => {
                // Simular sucesso/erro (80% sucesso)
                if (Math.random() > 0.2) {
                    evento.status = 'processado';
                    evento.protocolo = `ES${Date.now()}_${evento.id}`;
                    sucessos++;
                    
                    // Atualizar status da remunera√ß√£o se for S-1200
                    if (evento.tipo === 'S-1200') {
                        const remuneracao = dadosCache.remuneracaoESocial.find(r => 
                            r.funcionarioId === evento.funcionarioId && r.periodo === evento.periodo
                        );
                        if (remuneracao) {
                            remuneracao.statusS1200 = 'enviado';
                        }
                    }
                } else {
                    evento.status = 'erro';
                    erros++;
                }
            });

            // Atualizar exibi√ß√µes
            carregarEventosESocial();
            carregarRemuneracaoESocial();
            atualizarDashboardESocial();
            carregarTransmissaoESocial();

            // Mostrar resultado
            document.getElementById('transmissao-resultado').style.display = 'block';
            document.getElementById('transmissao-log').innerHTML = `
                <div style="background: #e8f5e8; padding: 15px; border-radius: 5px; margin-bottom: 10px;">
                    <strong>‚úÖ Sucessos: ${sucessos}</strong>
                </div>
                <div style="background: #ffe8e8; padding: 15px; border-radius: 5px;">
                    <strong>‚ùå Erros: ${erros}</strong>
                </div>
                <p><strong>Total processado:</strong> ${sucessos + erros} eventos</p>
            `;

            alert(`Transmiss√£o conclu√≠da!\n‚úÖ Sucessos: ${sucessos}\n‚ùå Erros: ${erros}`);
        }

        // Consultar retornos do governo
        function consultarRetornos() {
            // Simular consulta de retornos
            alert('Consultando retornos do governo...\n\n‚úÖ Todos os eventos processados est√£o com status "Aceito".');
        }

        // ============ SISTEMA DE VALIDA√á√ÉO E-SOCIAL ============

        // Validar dados do funcion√°rio para e-Social
        function validarDadosFuncionario(funcionario) {
            const erros = [];

            // Valida√ß√µes obrigat√≥rias
            if (!funcionario.cpf || !validarCPF(funcionario.cpf)) {
                erros.push('CPF inv√°lido ou n√£o informado');
            }

            if (!funcionario.pis || funcionario.pis.length !== 11) {
                erros.push('PIS deve ter 11 d√≠gitos');
            }

            if (!funcionario.nome || funcionario.nome.length < 2) {
                erros.push('Nome deve ter pelo menos 2 caracteres');
            }

            if (!funcionario.dataNascimento) {
                erros.push('Data de nascimento √© obrigat√≥ria');
            }

            if (!funcionario.dataAdmissao) {
                erros.push('Data de admiss√£o √© obrigat√≥ria');
            }

            if (!funcionario.categoriaESocial) {
                erros.push('Categoria e-Social √© obrigat√≥ria');
            }

            if (!funcionario.salarioBruto || funcionario.salarioBruto <= 0) {
                erros.push('Sal√°rio deve ser maior que zero');
            }

            // Validar endere√ßo
            if (!funcionario.endereco) {
                erros.push('Endere√ßo √© obrigat√≥rio');
            } else {
                if (!funcionario.endereco.cep || !validarCEP(funcionario.endereco.cep)) {
                    erros.push('CEP inv√°lido');
                }
                if (!funcionario.endereco.logradouro) {
                    erros.push('Logradouro √© obrigat√≥rio');
                }
                if (!funcionario.endereco.cidade) {
                    erros.push('Cidade √© obrigat√≥ria');
                }
                if (!funcionario.endereco.uf || funcionario.endereco.uf.length !== 2) {
                    erros.push('UF deve ter 2 caracteres');
                }
            }

            return erros;
        }

        // Validar CPF
        function validarCPF(cpf) {
            cpf = cpf.replace(/[^\d]/g, '');
            if (cpf.length !== 11) return false;
            
            // Verificar se todos os d√≠gitos s√£o iguais
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            // Validar d√≠gitos verificadores
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            
            let resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.charAt(9))) return false;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            
            resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.charAt(10))) return false;
            
            return true;
        }

        // Validar CEP
        function validarCEP(cep) {
            cep = cep.replace(/[^\d]/g, '');
            return cep.length === 8;
        }

        // Validar evento antes da transmiss√£o
        function validarEvento(evento) {
            const erros = [];
            
            if (!evento.tipo) {
                erros.push('Tipo de evento √© obrigat√≥rio');
            }
            
            if (!evento.funcionarioId) {
                erros.push('Funcion√°rio √© obrigat√≥rio');
            }
            
            if (!evento.periodo) {
                erros.push('Per√≠odo de compet√™ncia √© obrigat√≥rio');
            }
            
            // Valida√ß√µes espec√≠ficas por tipo de evento
            if (evento.tipo === 'S-1200') {
                if (!evento.dados || !evento.dados.salarioBase) {
                    erros.push('Dados de remunera√ß√£o s√£o obrigat√≥rios para S-1200');
                }
            }
            
            return erros;
        }

        // Validar todos os funcion√°rios
        function validarTodosFuncionarios() {
            const resultados = [];
            
            dadosCache.funcionarios.forEach(funcionario => {
                const erros = validarDadosFuncionario(funcionario);
                if (erros.length > 0) {
                    resultados.push({
                        funcionario: funcionario.nome,
                        erros: erros
                    });
                }
            });
            
            if (resultados.length === 0) {
                alert('‚úÖ Todos os funcion√°rios est√£o com dados v√°lidos para e-Social!');
            } else {
                let relatorio = '‚ùå Funcion√°rios com dados inv√°lidos:\n\n';
                resultados.forEach(result => {
                    relatorio += `üë§ ${result.funcionario}:\n`;
                    result.erros.forEach(erro => {
                        relatorio += `   ‚Ä¢ ${erro}\n`;
                    });
                    relatorio += '\n';
                });
                alert(relatorio);
            }
            
            return resultados;
        }

        // Executar valida√ß√£o antes da transmiss√£o
        function validarAntesTransmissao() {
            const eventosPendentes = dadosCache.eventosESocial.filter(e => e.status === 'pendente');
            const errosValidacao = [];
            
            eventosPendentes.forEach(evento => {
                const funcionario = dadosCache.funcionarios.find(f => f.id === evento.funcionarioId);
                
                // Validar funcion√°rio
                if (funcionario) {
                    const errosFuncionario = validarDadosFuncionario(funcionario);
                    if (errosFuncionario.length > 0) {
                        errosValidacao.push({
                            evento: `${evento.tipo} - ${evento.funcionarioNome}`,
                            erros: errosFuncionario
                        });
                    }
                }
                
                // Validar evento
                const errosEvento = validarEvento(evento);
                if (errosEvento.length > 0) {
                    errosValidacao.push({
                        evento: `${evento.tipo} - ${evento.funcionarioNome}`,
                        erros: errosEvento
                    });
                }
            });
            
            return errosValidacao;
        }

        // ============ INTEGRA√á√ÉO CONT√ÅBIL E-SOCIAL ============

        // Gerar lan√ßamentos cont√°beis a partir dos eventos e-Social
        function gerarLancamentosContabeis(evento) {
            if (evento.tipo === 'S-1200' && evento.dados) {
                const dados = evento.dados;
                const funcionario = dadosCache.funcionarios.find(f => f.id === evento.funcionarioId);
                
                if (!funcionario) return;

                // Lan√ßamento da folha de pagamento
                const lancamentoSalario = {
                    id: dadosCache.lancamentos.length + 1,
                    descricao: `Folha de Pagamento - ${funcionario.nome} - ${evento.periodo}`,
                    valor: dados.salarioBase,
                    tipo: 'despesa',
                    categoria: 'Sal√°rios',
                    conta: '3.1.01 - Sal√°rios e Ordenados',
                    data: new Date().toISOString().split('T')[0],
                    origem: 'esocial',
                    eventoId: evento.id
                };

                // Lan√ßamento dos encargos
                const lancamentoEncargos = {
                    id: dadosCache.lancamentos.length + 2,
                    descricao: `Encargos Sociais - ${funcionario.nome} - ${evento.periodo}`,
                    valor: calcularEncargosEmpresa(dados.salarioBase),
                    tipo: 'despesa',
                    categoria: 'Encargos Sociais',
                    conta: '3.1.02 - Encargos Sociais',
                    data: new Date().toISOString().split('T')[0],
                    origem: 'esocial',
                    eventoId: evento.id
                };

                // Lan√ßamento das provis√µes
                const lancamentoProvisoes = {
                    id: dadosCache.lancamentos.length + 3,
                    descricao: `Provis√µes Trabalhistas - ${funcionario.nome} - ${evento.periodo}`,
                    valor: calcularProvisoesTrabalhistasA(dados.salarioBase),
                    tipo: 'despesa',
                    categoria: 'Provis√µes',
                    conta: '3.1.03 - Provis√µes Trabalhistas',
                    data: new Date().toISOString().split('T')[0],
                    origem: 'esocial',
                    eventoId: evento.id
                };

                // Adicionar os lan√ßamentos
                dadosCache.lancamentos.push(lancamentoSalario);
                dadosCache.lancamentos.push(lancamentoEncargos);
                dadosCache.lancamentos.push(lancamentoProvisoes);

                return [lancamentoSalario, lancamentoEncargos, lancamentoProvisoes];
            }

            return [];
        }

        // Calcular encargos da empresa
        function calcularEncargosEmpresa(salarioBase) {
            const inss = salarioBase * 0.20; // INSS empresa
            const fgts = salarioBase * 0.08; // FGTS
            const seguroAcidente = salarioBase * 0.03; // Seguro acidente trabalho
            const salarioEducacao = salarioBase * 0.025; // Sal√°rio educa√ß√£o
            const incra = salarioBase * 0.002; // INCRA
            const sebrae = salarioBase * 0.006; // SEBRAE
            
            return inss + fgts + seguroAcidente + salarioEducacao + incra + sebrae;
        }

        // Calcular provis√µes trabalhistas
        function calcularProvisoesTrabalhistasA(salarioBase) {
            const ferias = salarioBase * (1/12) * 1.33; // F√©rias + 1/3
            const decimoTerceiro = salarioBase * (1/12); // 13¬∫ sal√°rio
            const fgtsFerias = (salarioBase * (1/12) * 1.33) * 0.08; // FGTS sobre f√©rias
            const fgtsDecimo = (salarioBase * (1/12)) * 0.08; // FGTS sobre 13¬∫
            
            return ferias + decimoTerceiro + fgtsFerias + fgtsDecimo;
        }

        // Processar integra√ß√£o cont√°bil de eventos processados
        function processarIntegracaoContabil() {
            const eventosProcessados = dadosCache.eventosESocial.filter(e => 
                e.status === 'processado' && !e.integracaoContabil
            );

            if (eventosProcessados.length === 0) {
                alert('N√£o h√° eventos processados para integra√ß√£o cont√°bil!');
                return;
            }

            let lancamentosGerados = 0;

            eventosProcessados.forEach(evento => {
                const lancamentos = gerarLancamentosContabeis(evento);
                if (lancamentos.length > 0) {
                    // Marcar evento como integrado
                    evento.integracaoContabil = true;
                    evento.dataIntegracao = new Date().toISOString();
                    lancamentosGerados += lancamentos.length;
                }
            });

            // Atualizar exibi√ß√µes
            carregarLancamentos();
            atualizarDashboard();

            alert(`Integra√ß√£o cont√°bil conclu√≠da!\n${lancamentosGerados} lan√ßamentos cont√°beis foram gerados automaticamente.`);
        }

        // Relat√≥rio de impacto cont√°bil dos eventos e-Social
        function gerarRelatorioImpactoContabil(periodo) {
            const eventosPereriodo = dadosCache.eventosESocial.filter(e => 
                e.periodo === periodo && e.status === 'processado'
            );

            if (eventosPereriodo.length === 0) {
                alert('Nenhum evento processado encontrado para o per√≠odo!');
                return;
            }

            let totalSalarios = 0;
            let totalEncargos = 0;
            let totalProvisoes = 0;

            eventosPereriodo.forEach(evento => {
                if (evento.tipo === 'S-1200' && evento.dados) {
                    totalSalarios += evento.dados.salarioBase;
                    totalEncargos += calcularEncargosEmpresa(evento.dados.salarioBase);
                    totalProvisoes += calcularProvisoesTrabalhistasA(evento.dados.salarioBase);
                }
            });

            const relatorio = `
RELAT√ìRIO DE IMPACTO CONT√ÅBIL - e-Social
Per√≠odo: ${periodo}
==========================================

üìä RESUMO DOS CUSTOS:

üí∞ Total de Sal√°rios: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalSalarios)}
üè¢ Total de Encargos: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalEncargos)}
üìã Total de Provis√µes: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalProvisoes)}

üí∏ CUSTO TOTAL DA FOLHA: ${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(totalSalarios + totalEncargos + totalProvisoes)}

üìà Eventos processados: ${eventosPereriodo.length}
            `;

            alert(relatorio);
            
            return {
                totalSalarios,
                totalEncargos,
                totalProvisoes,
                custoTotal: totalSalarios + totalEncargos + totalProvisoes
            };
        }


        // ============ FUN√á√ïES DE CONFIGURA√á√ïES ============

        // Salvar configura√ß√µes da empresa
        document.getElementById('empresa-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const configEmpresa = {
                razaoSocial: document.getElementById('empresa-razao').value,
                nomeFantasia: document.getElementById('empresa-fantasia').value,
                cnpj: document.getElementById('empresa-cnpj').value,
                inscricaoEstadual: document.getElementById('empresa-ie').value,
                endereco: {
                    cep: document.getElementById('empresa-cep').value,
                    logradouro: document.getElementById('empresa-logradouro').value,
                    cidade: document.getElementById('empresa-cidade').value,
                    uf: document.getElementById('empresa-uf').value
                },
                contato: {
                    telefone: document.getElementById('empresa-telefone').value,
                    email: document.getElementById('empresa-email').value
                }
            };
            
            localStorage.setItem('configEmpresa', JSON.stringify(configEmpresa));
            alert('‚úÖ Configura√ß√µes da empresa salvas com sucesso!');
        });

        // Salvar configura√ß√µes do sistema
        function salvarConfigSistema() {
            const configSistema = {
                tema: document.getElementById('tema-sistema').value,
                idioma: document.getElementById('idioma-sistema').value,
                dashboard: {
                    autoRefresh: document.getElementById('dashboard-auto-refresh').checked,
                    intervalo: document.getElementById('dashboard-intervalo').value
                },
                notificacoes: {
                    lancamentos: document.getElementById('notif-lancamentos').checked,
                    esocial: document.getElementById('notif-esocial').checked,
                    backup: document.getElementById('notif-backup').checked
                },
                cache: {
                    ativo: document.getElementById('cache-local').checked,
                    limite: document.getElementById('cache-limite').value
                }
            };
            
            localStorage.setItem('configSistema', JSON.stringify(configSistema));
            aplicarConfiguracoesSistema(configSistema);
            alert('‚úÖ Configura√ß√µes do sistema salvas com sucesso!');
        }

        // Aplicar configura√ß√µes do sistema
        function aplicarConfiguracoesSistema(config) {
            // Aplicar tema (para futura implementa√ß√£o)
            if (config.tema === 'escuro') {
                console.log('Tema escuro seria aplicado aqui');
            }
            
            // Aplicar idioma (para futura implementa√ß√£o)
            if (config.idioma !== 'pt-BR') {
                console.log(`Idioma ${config.idioma} seria aplicado aqui`);
            }
        }

        // Limpar cache
        function limparCache() {
            if (confirm('Tem certeza que deseja limpar o cache? Esta a√ß√£o n√£o pode ser desfeita.')) {
                // Limpar localStorage (exceto dados importantes)
                const dadosImportantes = {
                    sistemaContabilidade: localStorage.getItem('sistemaContabilidade'),
                    configEmpresa: localStorage.getItem('configEmpresa'),
                    configSistema: localStorage.getItem('configSistema')
                };
                
                localStorage.clear();
                
                // Restaurar dados importantes
                Object.keys(dadosImportantes).forEach(key => {
                    if (dadosImportantes[key]) {
                        localStorage.setItem(key, dadosImportantes[key]);
                    }
                });
                
                alert('üßπ Cache limpo com sucesso!');
            }
        }

        // Fun√ß√µes de usu√°rios
        function abrirModalNovoUsuario() {
            alert('üöß Funcionalidade em desenvolvimento!\nEm breve ser√° poss√≠vel adicionar novos usu√°rios.');
        }

        function editarUsuario(id) {
            alert(`üöß Edi√ß√£o do usu√°rio ID ${id} em desenvolvimento!`);
        }

        function bloquearUsuario(id) {
            if (confirm('Tem certeza que deseja bloquear este usu√°rio?')) {
                alert(`üîí Usu√°rio ID ${id} bloqueado com sucesso!`);
            }
        }

        function desbloquearUsuario(id) {
            if (confirm('Tem certeza que deseja desbloquear este usu√°rio?')) {
                alert(`üîì Usu√°rio ID ${id} desbloqueado com sucesso!`);
            }
        }

        function exportarUsuarios() {
            const usuarios = [
                {id: 1, nome: 'Administrador', email: 'admin@empresaexemplo.com.br', perfil: 'admin'},
                {id: 2, nome: 'Jo√£o Silva', email: 'joao@empresaexemplo.com.br', perfil: 'usuario'},
                {id: 3, nome: 'Maria Santos', email: 'maria@empresaexemplo.com.br', perfil: 'contador'}
            ];
            
            const dataStr = JSON.stringify(usuarios, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'usuarios_' + new Date().toISOString().slice(0, 10) + '.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Fun√ß√µes de backup
        function executarBackup() {
            const dadosBackup = {
                timestamp: new Date().toISOString(),
                dados: {
                    lancamentos: dadosCache.lancamentos,
                    funcionarios: dadosCache.funcionarios,
                    eventosESocial: dadosCache.eventosESocial,
                    remuneracaoESocial: dadosCache.remuneracaoESocial,
                    configEmpresa: JSON.parse(localStorage.getItem('configEmpresa') || '{}'),
                    configSistema: JSON.parse(localStorage.getItem('configSistema') || '{}')
                }
            };
            
            const dataStr = JSON.stringify(dadosBackup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'backup_sistema_' + new Date().toISOString().slice(0, 10) + '.json';
            link.click();
            URL.revokeObjectURL(url);
            
            alert('üíæ Backup realizado com sucesso!');
        }

        function exportarDados() {
            const dados = {
                lancamentos: dadosCache.lancamentos,
                funcionarios: dadosCache.funcionarios,
                contas: dadosCache.contas,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(dados, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'dados_exportados_' + new Date().toISOString().slice(0, 10) + '.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importarDados() {
            document.getElementById('arquivo-importacao').click();
        }

        document.getElementById('arquivo-importacao').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const dados = JSON.parse(e.target.result);
                    
                    if (confirm('Tem certeza que deseja importar estes dados? Isto substituir√° os dados atuais.')) {
                        if (dados.lancamentos) dadosCache.lancamentos = dados.lancamentos;
                        if (dados.funcionarios) dadosCache.funcionarios = dados.funcionarios;
                        if (dados.contas) dadosCache.contas = dados.contas;
                        
                        salvarDadosLocalStorage();
                        
                        // Recarregar as telas
                        atualizarDashboard();
                        carregarLancamentos();
                        carregarContas();
                        
                        alert('üì• Dados importados com sucesso!');
                    }
                } catch (error) {
                    alert('‚ùå Erro ao importar dados: arquivo inv√°lido!');
                }
            };
            reader.readAsText(file);
        });

        function limparLogs() {
            if (confirm('Tem certeza que deseja limpar todos os logs? Esta a√ß√£o n√£o pode ser desfeita.')) {
                // Aqui limparia os logs do sistema
                alert('üóëÔ∏è Logs limpos com sucesso!');
            }
        }

        // Carregar configura√ß√µes salvas
        function carregarConfiguracoes() {
            // Carregar configura√ß√µes da empresa
            const configEmpresa = localStorage.getItem('configEmpresa');
            if (configEmpresa) {
                const config = JSON.parse(configEmpresa);
                if (document.getElementById('empresa-razao')) {
                    document.getElementById('empresa-razao').value = config.razaoSocial || '';
                    document.getElementById('empresa-fantasia').value = config.nomeFantasia || '';
                    document.getElementById('empresa-cnpj').value = config.cnpj || '';
                    document.getElementById('empresa-ie').value = config.inscricaoEstadual || '';
                    
                    if (config.endereco) {
                        document.getElementById('empresa-cep').value = config.endereco.cep || '';
                        document.getElementById('empresa-logradouro').value = config.endereco.logradouro || '';
                        document.getElementById('empresa-cidade').value = config.endereco.cidade || '';
                        document.getElementById('empresa-uf').value = config.endereco.uf || '';
                    }
                    
                    if (config.contato) {
                        document.getElementById('empresa-telefone').value = config.contato.telefone || '';
                        document.getElementById('empresa-email').value = config.contato.email || '';
                    }
                }
            }
            
            // Carregar configura√ß√µes do sistema
            const configSistema = localStorage.getItem('configSistema');
            if (configSistema) {
                const config = JSON.parse(configSistema);
                if (document.getElementById('tema-sistema')) {
                    document.getElementById('tema-sistema').value = config.tema || 'claro';
                    document.getElementById('idioma-sistema').value = config.idioma || 'pt-BR';
                    
                    if (config.dashboard) {
                        document.getElementById('dashboard-auto-refresh').checked = config.dashboard.autoRefresh !== false;
                        document.getElementById('dashboard-intervalo').value = config.dashboard.intervalo || 30;
                    }
                    
                    if (config.notificacoes) {
                        document.getElementById('notif-lancamentos').checked = config.notificacoes.lancamentos !== false;
                        document.getElementById('notif-esocial').checked = config.notificacoes.esocial !== false;
                        document.getElementById('notif-backup').checked = config.notificacoes.backup || false;
                    }
                    
                    if (config.cache) {
                        document.getElementById('cache-local').checked = config.cache.ativo !== false;
                        document.getElementById('cache-limite').value = config.cache.limite || 50;
                    }
                }
            }
        }

        // ============ FUN√á√ïES DE CONFIGURA√á√ÉO DO PLANO DE CONTAS ============

        // Carregar configura√ß√£o das contas
        function carregarConfigContas() {
            const tbody = document.getElementById('config-contas-tbody');
            if (!tbody) return;

            tbody.innerHTML = '';

            if (!dadosCache.contas || !Array.isArray(dadosCache.contas)) {
                tbody.innerHTML = '<tr><td colspan="7">Nenhuma conta encontrada</td></tr>';
                return;
            }

            // Calcular saldos atuais
            const saldos = calcularSaldosContas();
            
            dadosCache.contas.forEach(conta => {
                const row = document.createElement('tr');
                const saldo = saldos[conta.codigo] || 0;
                
                row.innerHTML = `
                    <td><strong>${conta.codigo}</strong></td>
                    <td>${conta.nome}</td>
                    <td><span class="status ${conta.tipo.toLowerCase()}">${conta.tipo}</span></td>
                    <td>${conta.natureza || 'Devedora'}</td>
                    <td><span class="status ${conta.status === 'ativo' ? 'ativo' : 'bloqueado'}">${conta.status === 'ativo' ? '‚úÖ Ativo' : 'üîí Inativo'}</span></td>
                    <td>${new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(saldo)}</td>
                    <td>
                        <button class="btn-action" onclick="editarConta('${conta.codigo}')" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-action" onclick="toggleStatusConta('${conta.codigo}')" title="${conta.status === 'ativo' ? 'Desativar' : 'Ativar'}">${conta.status === 'ativo' ? 'üîí' : '‚úÖ'}</button>
                        <button class="btn-action" onclick="excluirConta('${conta.codigo}')" title="Excluir" style="color: #e74c3c;">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            atualizarEstatisticasContas();
        }

        // Calcular saldos das contas baseado nos lan√ßamentos
        function calcularSaldosContas() {
            const saldos = {};
            
            if (dadosCache.lancamentos && Array.isArray(dadosCache.lancamentos)) {
                dadosCache.lancamentos.forEach(lancamento => {
                    const conta = lancamento.conta || lancamento.categoria;
                    if (conta) {
                        if (!saldos[conta]) saldos[conta] = 0;
                        
                        if (lancamento.tipo === 'receita') {
                            saldos[conta] += lancamento.valor;
                        } else if (lancamento.tipo === 'despesa') {
                            saldos[conta] -= lancamento.valor;
                        }
                    }
                });
            }
            
            return saldos;
        }

        // Atualizar estat√≠sticas das contas
        function atualizarEstatisticasContas() {
            if (!dadosCache.contas) return;
            
            const total = dadosCache.contas.length;
            const ativas = dadosCache.contas.filter(c => c.status === 'ativo').length;
            const inativas = total - ativas;
            
            const elementoTotal = document.getElementById('total-contas');
            const elementoAtivas = document.getElementById('contas-ativas');
            const elementoInativas = document.getElementById('contas-inativas');
            
            if (elementoTotal) elementoTotal.textContent = total;
            if (elementoAtivas) elementoAtivas.textContent = ativas;
            if (elementoInativas) elementoInativas.textContent = inativas;
        }

        // Abrir modal para nova conta
        function abrirModalNovaConta() {
            document.getElementById('modal-nova-conta').style.display = 'flex';
            document.getElementById('form-nova-conta').reset();
            document.getElementById('nova-conta-ativa').checked = true;
        }

        // Fechar modal
        function fecharModalNovaConta() {
            document.getElementById('modal-nova-conta').style.display = 'none';
        }

        // Salvar nova conta
        function salvarNovaConta(event) {
            event.preventDefault();
            
            const novaConta = {
                codigo: document.getElementById('nova-conta-codigo').value.trim(),
                nome: document.getElementById('nova-conta-nome').value.trim(),
                tipo: document.getElementById('nova-conta-tipo').value,
                natureza: document.getElementById('nova-conta-natureza').value,
                descricao: document.getElementById('nova-conta-descricao').value.trim(),
                status: document.getElementById('nova-conta-ativa').checked ? 'ativo' : 'inativo'
            };

            // Validar se conta j√° existe
            const jaExiste = dadosCache.contas.some(c => c.codigo === novaConta.codigo);
            if (jaExiste) {
                alert('‚ùå J√° existe uma conta com este c√≥digo!');
                return;
            }

            // Adicionar nova conta
            dadosCache.contas.push(novaConta);
            
            // Salvar no localStorage
            salvarDadosLocalStorage();
            
            // Recarregar a lista
            carregarConfigContas();
            carregarContas(); // Atualizar lista principal tamb√©m
            
            // Fechar modal
            fecharModalNovaConta();
            
            alert('‚úÖ Nova conta adicionada com sucesso!');
        }

        // Editar conta existente
        function editarConta(codigo) {
            const conta = dadosCache.contas.find(c => c.codigo === codigo);
            if (!conta) return;

            // Preencher modal com dados existentes
            document.getElementById('nova-conta-codigo').value = conta.codigo;
            document.getElementById('nova-conta-nome').value = conta.nome;
            document.getElementById('nova-conta-tipo').value = conta.tipo;
            document.getElementById('nova-conta-natureza').value = conta.natureza || 'Devedora';
            document.getElementById('nova-conta-descricao').value = conta.descricao || '';
            document.getElementById('nova-conta-ativa').checked = conta.status === 'ativo';

            // Alterar t√≠tulo e bot√£o
            document.querySelector('#modal-nova-conta h3').textContent = '‚úèÔ∏è Editar Conta Cont√°bil';
            
            // Modificar o evento do form temporariamente
            const form = document.getElementById('form-nova-conta');
            form.onsubmit = function(event) {
                event.preventDefault();
                atualizarConta(codigo);
            };
            
            document.getElementById('modal-nova-conta').style.display = 'flex';
        }

        // Atualizar conta existente
        function atualizarConta(codigoOriginal) {
            const conta = dadosCache.contas.find(c => c.codigo === codigoOriginal);
            if (!conta) return;

            const novosDados = {
                codigo: document.getElementById('nova-conta-codigo').value.trim(),
                nome: document.getElementById('nova-conta-nome').value.trim(),
                tipo: document.getElementById('nova-conta-tipo').value,
                natureza: document.getElementById('nova-conta-natureza').value,
                descricao: document.getElementById('nova-conta-descricao').value.trim(),
                status: document.getElementById('nova-conta-ativa').checked ? 'ativo' : 'inativo'
            };

            // Verificar se c√≥digo foi alterado e n√£o conflita
            if (novosDados.codigo !== codigoOriginal) {
                const jaExiste = dadosCache.contas.some(c => c.codigo === novosDados.codigo);
                if (jaExiste) {
                    alert('‚ùå J√° existe uma conta com este c√≥digo!');
                    return;
                }
            }

            // Atualizar dados da conta
            Object.assign(conta, novosDados);
            
            // Salvar no localStorage
            salvarDadosLocalStorage();
            
            // Recarregar listas
            carregarConfigContas();
            carregarContas();
            
            // Fechar modal e restaurar estado original
            fecharModalNovaConta();
            document.querySelector('#modal-nova-conta h3').textContent = '‚ûï Nova Conta Cont√°bil';
            document.getElementById('form-nova-conta').onsubmit = salvarNovaConta;
            
            alert('‚úÖ Conta atualizada com sucesso!');
        }

        // Alternar status da conta
        function toggleStatusConta(codigo) {
            const conta = dadosCache.contas.find(c => c.codigo === codigo);
            if (!conta) return;

            const novoStatus = conta.status === 'ativo' ? 'inativo' : 'ativo';
            const acao = novoStatus === 'ativo' ? 'ativar' : 'desativar';
            
            if (confirm(`Tem certeza que deseja ${acao} a conta "${conta.nome}"?`)) {
                conta.status = novoStatus;
                salvarDadosLocalStorage();
                carregarConfigContas();
                carregarContas();
                
                alert(`‚úÖ Conta ${acao === 'ativar' ? 'ativada' : 'desativada'} com sucesso!`);
            }
        }

        // Excluir conta
        function excluirConta(codigo) {
            const conta = dadosCache.contas.find(c => c.codigo === codigo);
            if (!conta) return;

            // Verificar se conta est√° sendo usada
            const emUso = dadosCache.lancamentos.some(l => 
                l.conta === codigo || l.categoria === conta.nome
            );

            if (emUso) {
                alert('‚ùå Esta conta n√£o pode ser exclu√≠da pois possui lan√ßamentos associados!');
                return;
            }

            if (confirm(`Tem certeza que deseja excluir a conta "${conta.nome}"?\n\nEsta a√ß√£o n√£o pode ser desfeita.`)) {
                dadosCache.contas = dadosCache.contas.filter(c => c.codigo !== codigo);
                salvarDadosLocalStorage();
                carregarConfigContas();
                carregarContas();
                
                alert('üóëÔ∏è Conta exclu√≠da com sucesso!');
            }
        }

        // Filtrar contas
        function filtrarContas() {
            const filtroTipo = document.getElementById('filtro-tipo-conta').value.toLowerCase();
            const busca = document.getElementById('buscar-conta').value.toLowerCase();
            
            const rows = document.querySelectorAll('#config-contas-tbody tr');
            
            rows.forEach(row => {
                const codigo = row.cells[0].textContent.toLowerCase();
                const nome = row.cells[1].textContent.toLowerCase();
                const tipo = row.cells[2].textContent.toLowerCase();
                
                const matchTipo = !filtroTipo || tipo.includes(filtroTipo);
                const matchBusca = !busca || codigo.includes(busca) || nome.includes(busca);
                
                row.style.display = matchTipo && matchBusca ? '' : 'none';
            });
        }

        // Exportar plano de contas
        function exportarPlanoContas() {
            const plano = {
                timestamp: new Date().toISOString(),
                contas: dadosCache.contas
            };
            
            const dataStr = JSON.stringify(plano, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'plano_contas_' + new Date().toISOString().slice(0, 10) + '.json';
            link.click();
            URL.revokeObjectURL(url);
            
            alert('üì§ Plano de contas exportado com sucesso!');
        }

        // Importar plano de contas
        function importarPlanoContas() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const dados = JSON.parse(e.target.result);
                        
                        if (dados.contas && Array.isArray(dados.contas)) {
                            if (confirm('Tem certeza que deseja importar este plano de contas?\n\nIsto substituir√° o plano atual!')) {
                                dadosCache.contas = dados.contas;
                                salvarDadosLocalStorage();
                                carregarConfigContas();
                                carregarContas();
                                
                                alert('üì• Plano de contas importado com sucesso!');
                            }
                        } else {
                            alert('‚ùå Arquivo inv√°lido! Formato esperado n√£o encontrado.');
                        }
                    } catch (error) {
                        alert('‚ùå Erro ao importar: arquivo inv√°lido!');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }

        // Restaurar plano de contas padr√£o
        function restaurarPlanoDefault() {
            if (confirm('Tem certeza que deseja restaurar o plano de contas padr√£o?\n\nIsto substituir√° todas as contas atuais!')) {
                // Restaurar plano b√°sico
                dadosCache.contas = [
                    { codigo: '1.1.01', nome: 'Caixa', tipo: 'Ativo', natureza: 'Devedora', status: 'ativo' },
                    { codigo: '1.1.02', nome: 'Bancos', tipo: 'Ativo', natureza: 'Devedora', status: 'ativo' },
                    { codigo: '1.2.01', nome: 'Clientes', tipo: 'Ativo', natureza: 'Devedora', status: 'ativo' },
                    { codigo: '2.1.01', nome: 'Fornecedores', tipo: 'Passivo', natureza: 'Credora', status: 'ativo' },
                    { codigo: '2.1.02', nome: 'Contas a Pagar', tipo: 'Passivo', natureza: 'Credora', status: 'ativo' },
                    { codigo: '3.1.01', nome: 'Capital Social', tipo: 'Patrim√¥nio', natureza: 'Credora', status: 'ativo' },
                    { codigo: '4.1.01', nome: 'Receita de Vendas', tipo: 'Receita', natureza: 'Credora', status: 'ativo' },
                    { codigo: '5.1.01', nome: 'Custo das Vendas', tipo: 'Despesa', natureza: 'Devedora', status: 'ativo' },
                    { codigo: '5.2.01', nome: 'Despesas Administrativas', tipo: 'Despesa', natureza: 'Devedora', status: 'ativo' },
                    { codigo: '5.2.02', nome: 'Despesas Comerciais', tipo: 'Despesa', natureza: 'Devedora', status: 'ativo' }
                ];
                
                salvarDadosLocalStorage();
                carregarConfigContas();
                carregarContas();
                
                alert('üîÑ Plano de contas padr√£o restaurado com sucesso!');
            }
        }

        // ============ FUN√á√ïES ESPECIAIS DE NAVEGA√á√ÉO ============


        // Mostrar se√ß√£o de funcion√°rios com foco na tabela
        function showFuncionariosSection() {
            showSection('folha');
            // Scroll para a lista de funcion√°rios ap√≥s carregar
            setTimeout(() => {
                const funcSection = document.querySelector('#funcionarios-tbody');
                if (funcSection) {
                    funcSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }

        // Definir data padr√£o para hoje
        document.getElementById('data').valueAsDate = new Date();
        document.getElementById('balanco-data').valueAsDate = new Date();
        
        // Definir per√≠odos padr√£o
        const hoje = new Date();
        const mesAtual = hoje.getFullYear() + '-' + String(hoje.getMonth() + 1).padStart(2, '0');
        document.getElementById('sped-periodo').value = mesAtual;
        document.getElementById('folha-periodo').value = mesAtual;
        document.getElementById('imposto-periodo').value = mesAtual;
        
        // e-Social
        if (document.getElementById('evento-periodo')) {
            document.getElementById('evento-periodo').value = mesAtual;
        }
        if (document.getElementById('rem-periodo')) {
            document.getElementById('rem-periodo').value = mesAtual;
        }

        // Sistema inicializado apenas ap√≥s login - dados s√£o carregados na fun√ß√£o inicializarSistema()

        // ============ SISTEMA DE LOGIN ============
        
        // Usu√°rios de demonstra√ß√£o
        const usuariosDemo = {
            'admin': {
                senha: 'demo123',
                nome: 'Administrador do Sistema',
                perfil: 'admin',
                permissoes: ['dashboard', 'lancamentos', 'relatorios', 'configuracoes', 'usuarios']
            },
            'contador': {
                senha: 'contabil2024',
                nome: 'Contador Respons√°vel',
                perfil: 'contador',
                permissoes: ['dashboard', 'lancamentos', 'relatorios', 'fiscal', 'esocial']
            }
        };

        // Vari√°vel global para armazenar usu√°rio logado
        let usuarioLogado = null;

        // Fun√ß√£o para abrir/fechar modal de login
        function toggleLoginModal() {
            const modal = document.getElementById('loginModal');
            const isVisible = modal.style.display === 'block';
            
            if (isVisible) {
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            } else {
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
                document.getElementById('username').focus();
            }
        }

        // Fun√ß√£o para realizar login
        function realizarLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('loginMessage');
            
            // Limpar mensagens anteriores
            messageDiv.style.display = 'none';
            messageDiv.className = 'login-message';
            
            // Validar campos
            if (!username || !password) {
                mostrarMensagemLogin('Por favor, preencha todos os campos!', 'error');
                return;
            }
            
            // Verificar credenciais
            const usuario = usuariosDemo[username.toLowerCase()];
            
            if (!usuario || usuario.senha !== password) {
                mostrarMensagemLogin('Usu√°rio ou senha incorretos!', 'error');
                return;
            }
            
            // Login bem-sucedido
            usuarioLogado = {
                username: username.toLowerCase(),
                nome: usuario.nome,
                perfil: usuario.perfil,
                permissoes: usuario.permissoes,
                dataLogin: new Date().toISOString()
            };
            
            // Salvar no localStorage
            localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
            
            mostrarMensagemLogin(`Bem-vindo, ${usuario.nome}!`, 'success');
            
            // Fechar modal ap√≥s 1.5 segundos
            setTimeout(() => {
                toggleLoginModal();
                atualizarInterfaceLogin();
                
                // Registrar log de login
                registrarLog('LOGIN_SUCESSO', `Login realizado: ${usuario.nome} (${usuario.perfil})`);
                
                // Mostrar notifica√ß√£o de sucesso
                mostrarNotificacao(`üéâ Login realizado com sucesso! Bem-vindo, ${usuario.nome}`, 'success');
                
                // Limpar formul√°rio
                document.getElementById('loginForm').reset();
            }, 1500);
        }

        // Fun√ß√£o para mostrar mensagens no modal de login
        function mostrarMensagemLogin(mensagem, tipo) {
            const messageDiv = document.getElementById('loginMessage');
            messageDiv.textContent = mensagem;
            messageDiv.className = `login-message ${tipo}`;
            messageDiv.style.display = 'block';
        }

        // Fun√ß√£o para atualizar interface baseada no login
        function atualizarInterfaceLogin() {
            const loginBtn = document.querySelector('.login-btn');
            
            if (usuarioLogado) {
                // Usu√°rio logado - mostrar informa√ß√µes do usu√°rio
                loginBtn.innerHTML = `üëã Ol√°, ${usuarioLogado.nome.split(' ')[0]}`;
                loginBtn.onclick = function() {
                    mostrarPerfilUsuario();
                };
                
                // Adicionar indicador de usu√°rio logado no dashboard
                adicionarIndicadorUsuario();
            } else {
                // Usu√°rio n√£o logado - mostrar bot√£o de login
                loginBtn.innerHTML = 'üë§ Login';
                loginBtn.onclick = function() {
                    toggleLoginModal();
                };
            }
        }

        // Fun√ß√£o para mostrar perfil do usu√°rio
        function mostrarPerfilUsuario() {
            if (!usuarioLogado) return;
            
            const perfil = `
üîê PERFIL DO USU√ÅRIO
==========================================
üë§ Nome: ${usuarioLogado.nome}
üÜî Usu√°rio: ${usuarioLogado.username}
üé≠ Perfil: ${usuarioLogado.perfil}
üìÖ Login: ${new Date(usuarioLogado.dataLogin).toLocaleString('pt-BR')}

üîë PERMISS√ïES:
${usuarioLogado.permissoes.map(p => `‚Ä¢ ${p}`).join('\n')}

Deseja fazer logout?
            `;
            
            if (confirm(perfil)) {
                realizarLogout();
            }
        }

        // Fun√ß√£o para realizar logout
        function realizarLogout() {
            if (!usuarioLogado) return;
            
            // Registrar log de logout
            registrarLog('LOGOUT', `Logout realizado: ${usuarioLogado.nome}`);
            
            // Limpar dados do usu√°rio
            usuarioLogado = null;
            localStorage.removeItem('usuarioLogado');
            
            // Atualizar interface
            atualizarInterfaceLogin();
            removerIndicadorUsuario();
            
            // Mostrar notifica√ß√£o
            mostrarNotificacao('üëã Logout realizado com sucesso!', 'info');
        }

        // Fun√ß√£o para adicionar indicador de usu√°rio logado
        function adicionarIndicadorUsuario() {
            // Remover indicador existente se houver
            removerIndicadorUsuario();
            
            const header = document.querySelector('.header-top h1');
            const indicador = document.createElement('small');
            indicador.id = 'usuario-logado-indicador';
            indicador.style.cssText = `
                display: block;
                font-size: 0.8rem;
                color: #666;
                font-weight: normal;
                margin-top: 5px;
            `;
            indicador.textContent = `Logado como: ${usuarioLogado.nome} (${usuarioLogado.perfil})`;
            header.appendChild(indicador);
        }

        // Fun√ß√£o para remover indicador de usu√°rio
        function removerIndicadorUsuario() {
            const indicador = document.getElementById('usuario-logado-indicador');
            if (indicador) {
                indicador.remove();
            }
        }

        // Fun√ß√£o para mostrar notifica√ß√£o
        function mostrarNotificacao(mensagem, tipo = 'info') {
            // Criar elemento de notifica√ß√£o se n√£o existir
            let notification = document.getElementById('notification');
            if (!notification) {
                notification = document.createElement('div');
                notification.id = 'notification';
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-weight: 500;
                    z-index: 10001;
                    transform: translateX(400px);
                    transition: transform 0.3s ease;
                    max-width: 350px;
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                `;
                document.body.appendChild(notification);
            }
            
            // Definir cores baseadas no tipo
            const cores = {
                success: '#28a745',
                error: '#dc3545',
                info: '#17a2b8',
                warning: '#ffc107'
            };
            
            notification.style.backgroundColor = cores[tipo] || cores.info;
            notification.textContent = mensagem;
            
            // Mostrar notifica√ß√£o
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Ocultar ap√≥s 4 segundos
            setTimeout(() => {
                notification.style.transform = 'translateX(400px)';
            }, 4000);
        }

        // Fun√ß√£o para login inicial (tela cheia)
        function realizarLoginInicial(event) {
            event.preventDefault();
            
            const username = document.getElementById('screenUsername').value.trim();
            const password = document.getElementById('screenPassword').value;
            const messageDiv = document.getElementById('loginScreenMessage');
            
            // Limpar mensagens anteriores
            messageDiv.style.display = 'none';
            messageDiv.className = 'login-message';
            
            // Validar campos
            if (!username || !password) {
                mostrarMensagemLoginScreen('Por favor, preencha todos os campos!', 'error');
                return;
            }
            
            // Verificar credenciais
            const usuario = usuariosDemo[username.toLowerCase()];
            
            if (!usuario || usuario.senha !== password) {
                mostrarMensagemLoginScreen('Usu√°rio ou senha incorretos!', 'error');
                return;
            }
            
            // Login bem-sucedido
            usuarioLogado = {
                username: username.toLowerCase(),
                nome: usuario.nome,
                perfil: usuario.perfil,
                permissoes: usuario.permissoes,
                dataLogin: new Date().toISOString()
            };
            
            // Salvar no localStorage
            localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
            
            mostrarMensagemLoginScreen(`Bem-vindo, ${usuario.nome}!`, 'success');
            
            // Redirecionar para o sistema ap√≥s 1.5 segundos
            setTimeout(() => {
                redirecionarParaSistema();
                
                // Registrar log de login
                registrarLog('LOGIN_SUCESSO', `Login realizado: ${usuario.nome} (${usuario.perfil})`);
                
                // Mostrar notifica√ß√£o de sucesso
                mostrarNotificacao(`üéâ Login realizado com sucesso! Bem-vindo, ${usuario.nome}`, 'success');
                
                // Limpar formul√°rio
                document.getElementById('loginScreenForm').reset();
            }, 1500);
        }

        // Fun√ß√£o para mostrar mensagens na tela de login inicial
        function mostrarMensagemLoginScreen(mensagem, tipo) {
            const messageDiv = document.getElementById('loginScreenMessage');
            messageDiv.textContent = mensagem;
            messageDiv.className = `login-message ${tipo}`;
            messageDiv.style.display = 'block';
        }

        // Fun√ß√£o para redirecionar para o sistema
        function redirecionarParaSistema() {
            // Ocultar tela de login
            document.getElementById('loginScreen').style.display = 'none';
            
            // Mostrar sistema
            document.getElementById('sistemaContainer').classList.remove('sistema-oculto');
            
            // Atualizar interface de login
            atualizarInterfaceLogin();
            
            // Carregar dados iniciais do sistema
            inicializarSistema();
        }

        // Fun√ß√£o para inicializar o sistema ap√≥s login
        function inicializarSistema() {
            // Carregar dados iniciais
            carregarLancamentos();
            carregarContas();
            atualizarDashboard();
            carregarConfiguracoes();
            
            // Salvar dados iniciais se n√£o existir no localStorage
            if (!localStorage.getItem('sistemaContabilidade')) {
                salvarDadosLocalStorage();
            }
        }

        // Fun√ß√£o modificada para logout - retornar √† tela de login
        function realizarLogout() {
            if (!usuarioLogado) return;
            
            // Registrar log de logout
            registrarLog('LOGOUT', `Logout realizado: ${usuarioLogado.nome}`);
            
            // Limpar dados do usu√°rio
            usuarioLogado = null;
            localStorage.removeItem('usuarioLogado');
            
            // Mostrar notifica√ß√£o
            mostrarNotificacao('üëã Logout realizado com sucesso!', 'info');
            
            // Retornar √† tela de login
            setTimeout(() => {
                voltarParaLogin();
            }, 1000);
        }

        // Fun√ß√£o para voltar √† tela de login
        function voltarParaLogin() {
            // Ocultar sistema
            document.getElementById('sistemaContainer').classList.add('sistema-oculto');
            
            // Mostrar tela de login
            document.getElementById('loginScreen').style.display = 'flex';
            
            // Limpar formul√°rio e focar no campo usu√°rio
            document.getElementById('loginScreenForm').reset();
            document.getElementById('screenUsername').focus();
            
            // Remover indicador de usu√°rio
            removerIndicadorUsuario();
        }

        // Verificar se h√° usu√°rio logado ao carregar a p√°gina
        function verificarUsuarioLogado() {
            const dadosUsuario = localStorage.getItem('usuarioLogado');
            if (dadosUsuario) {
                usuarioLogado = JSON.parse(dadosUsuario);
                redirecionarParaSistema();
            } else {
                // Garantir que a tela de login esteja vis√≠vel
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('sistemaContainer').classList.add('sistema-oculto');
            }
        }

        // Fechar modal ao clicar fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('loginModal');
            if (event.target === modal) {
                toggleLoginModal();
            }
        }

        // Verificar usu√°rio logado quando a p√°gina carregar
        verificarUsuarioLogado();

        // Simular atualiza√ß√µes em tempo real
        setInterval(() => {
            // Atualizar alguns valores aleatoriamente para simular tempo real
            const variation = (Math.random() - 0.5) * 1000;
            const currentValue = parseFloat(document.getElementById('saldo-caixa').textContent.replace(/[^\d,]/g, '').replace(',', '.'));
            const newValue = currentValue + variation;
            
            document.getElementById('saldo-caixa').textContent = 
                new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(newValue);
        }, 10000); // Atualizar a cada 10 segundos
    </script>

    <!-- Modal de Login -->
    <div id="loginModal" class="login-modal">
        <div class="login-modal-content">
            <div class="login-header">
                <h2>üîê Login do Sistema</h2>
                <span class="login-close" onclick="toggleLoginModal()">&times;</span>
            </div>
            <form id="loginForm" onsubmit="realizarLogin(event)">
                <div class="login-form-group">
                    <label for="username">üë§ Usu√°rio:</label>
                    <input type="text" id="username" required placeholder="Digite seu usu√°rio">
                </div>
                <div class="login-form-group">
                    <label for="password">üîí Senha:</label>
                    <input type="password" id="password" required placeholder="Digite sua senha">
                </div>
                <div class="login-demo-info">
                    <h4>üìã Dados de Demonstra√ß√£o:</h4>
                    <p><strong>Usu√°rio:</strong> admin</p>
                    <p><strong>Senha:</strong> demo123</p>
                    <p><strong>Usu√°rio:</strong> contador</p>
                    <p><strong>Senha:</strong> contabil2024</p>
                </div>
                <button type="submit" class="login-submit-btn">üöÄ Entrar no Sistema</button>
            </form>
            <div id="loginMessage" class="login-message"></div>
        </div>
    </div>

</body>
</html>